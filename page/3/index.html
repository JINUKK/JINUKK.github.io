<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>KOO|디벨로그</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="What I learned">
<meta property="og:type" content="website">
<meta property="og:title" content="KOO|디벨로그">
<meta property="og:url" content="http://JINUKK.github.io/page/3/index.html">
<meta property="og:site_name" content="KOO|디벨로그">
<meta property="og:description" content="What I learned">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="KOO|디벨로그">
<meta name="twitter:description" content="What I learned">
  
    <link rel="alternate" href="/atom.xml" title="KOO|디벨로그" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">KOO|디벨로그</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Develop &amp; Sabjil Log</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://JINUKK.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-190521-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/21/190521-Django-Study/" class="article-date">
  <time datetime="2019-05-21T14:40:04.000Z" itemprop="datePublished">2019-05-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/21/190521-Django-Study/">2019.05.21 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Django-Project"><a href="#Django-Project" class="headerlink" title="Django Project"></a>Django Project</h2><ul>
<li><p>debug tool bar 설치하기</p>
<ol>
<li><p>debug tool bar를 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django-debug-toolbar</span><br></pre></td></tr></table></figure>
</li>
<li><p>settings.py에 해당 관련 항목을 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># INSTALLED_APPS에 항목 추가</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="string">'debug_toolbar'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># MIDDLEWARE에 항목 추가</span></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="string">'debug_toolbar.middleware.DebugToolbarMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>settings.py에 아래 항목을 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># debug = True, internal_ips</span></span><br><span class="line">INTERNAL_IPS = [<span class="string">'127.0.0.1'</span>]</span><br><span class="line"></span><br><span class="line">DEBUG_TOOLBAR_PANELS = [</span><br><span class="line">    <span class="string">'debug_toolbar.panels.versions.VersionsPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.timer.TimerPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.settings.SettingsPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.headers.HeadersPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.request.RequestPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.sql.SQLPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.staticfiles.StaticFilesPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.templates.TemplatesPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.cache.CachePanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.signals.SignalsPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.logging.LoggingPanel'</span>,</span><br><span class="line">    <span class="string">'debug_toolbar.panels.redirects.RedirectsPanel'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>config/urls.py에 아래 소스 코드를 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> settings.DEBUG:</span><br><span class="line">    <span class="keyword">import</span> debug_toolbar</span><br><span class="line">    urlpatterns = [</span><br><span class="line">        path(<span class="string">'debug/'</span>, include(debug_toolbar.urls)),</span><br><span class="line">    ] + urlpatterns</span><br></pre></td></tr></table></figure>
</li>
<li><p>관련 static 파일 업로드를 위해 collectstatic 명령어를 입력한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py collecstatic</span><br></pre></td></tr></table></figure>
</li>
<li><p>관리자 페이지로 접속하여 debug tool bar가 작동하는지 확인한다.</p>
</li>
</ol>
</li>
<li><p>django extensions 설치하기</p>
<ol>
<li><p>extensions 모듈을 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django-extensions</span><br></pre></td></tr></table></figure>
</li>
<li><p>settings.py에 해당 관련 항목을 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># INSTALLED_APPS에 항목 추가</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment">#...</span></span><br><span class="line">    <span class="string">'django_extensions'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>settings.py에 아래 항목을 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GRAPH_MODELS = &#123;</span><br><span class="line">    <span class="string">'all_applications'</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">'group_models'</span>: <span class="literal">True</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>그래프 출력 기능을 위해 아래 모듈을 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install python3-dev graphviz libgraphviz-dev pkg-config</span><br><span class="line"></span><br><span class="line">$ pip install pygraphviz</span><br></pre></td></tr></table></figure>
</li>
<li><p>그래프 생성 명령어를 입력해본다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 전체 모델에 대한 그래프 출력</span></span><br><span class="line">$ python manage.py graph_models -a -g -o model_graph.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># 특정 앱에 대한 그래프 출력</span></span><br><span class="line"><span class="comment"># [앱 이름]에는 현재 앱 이름을 기입하면 된다.</span></span><br><span class="line"><span class="comment"># 여러 앱의 이름을 쓸 경우 콤마가 아닌 띄워쓰기로 기입하면 된다.</span></span><br><span class="line">$ python manage.py graph_models [앱 이름] -o models.png</span><br></pre></td></tr></table></figure>
</li>
<li><p>다음 명령어를 통해 데이터베이스를 삭제하고 새로 생성할 수 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py reset_db</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>EC2 인스터스 만들기</p>
<ul>
<li>EC2(Elastic Cloud Computing)</li>
<li>아마존 서버 인스턴스 서비스</li>
</ul>
<ol>
<li><p>아마존 AWS 홈페이지로 접속해 [콘솔에 로그인]한다.</p>
</li>
<li><p>[서비스] 메뉴에서 컴퓨팅/EC2를 누른다.</p>
</li>
<li><p>EC2 화면에서 인스턴스 시작을 누른다.</p>
</li>
<li><p>운영체제 중에서 Ubuntu Server 18.04 64Bit를 선택한다.</p>
</li>
<li><p>인스턴스 유형에서는 프리티어 유형의 t2.micro를 선택한다.</p>
</li>
<li><p>인스턴스 세부 정보 구성 단계에서는 변경하는 것이 없이 넘어간다.</p>
</li>
<li><p>스토리지 추가 단계에서는 서버의 저장 공간을 20Gib로, 볼륨 유형은 범용 SSD를 선택한다.</p>
</li>
<li><p>태그 추가 단계에서는 변경하는 것 없이 넘어간다.</p>
</li>
<li><p>보안 그룹 구성 단계에서는 다음과 같이 설정한다.</p>
<ul>
<li>보안 그룹 이름 및 설명을 기입한다.</li>
<li>SSH, HTTP를 추가한다.</li>
<li>포트 번호 8000번도 테스트용으로 추가한다.</li>
</ul>
</li>
<li><p>검토 및 시작 단계에서는 내용을 확인하고 시작하기를 누른다.</p>
</li>
<li><p>인스턴스가 추가되면 인스턴스에 접속하기 위해 키페어를 생성하거나 선택해야 한다.</p>
<ul>
<li>새 키 페어 생성을 선택하고 키 페어 이름을 입력한 후 키 페어 다운로드를 누른다.</li>
<li>다시 다운받을 수 없으므로, 키 페어 파일이 다운로드된 것을 확인하자.</li>
<li>다운로드가 되면 인스턴스 시작 버튼이 활성화되고 누르도록 한다.</li>
<li>인스턴스 보기를 누르고 인스턴스 목록에서 방금 생성한 인스턴스를 확인한다.<ul>
<li>인스턴스 이름 부분에 있는 연필 아이콘을 누르고 이름을 설정하자.</li>
<li>이름을 설정한 후, 하단에 퍼블릭 DNS를 확인하자.<ul>
<li>퍼블릭 DNS는 고정 IP가 아니다.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>터미널을 열고 SSH로 접속하여 서버를 셋팅한다.</p>
<ul>
<li><p>다음 명렁어를 입력하여 키 페어 파일의 권한을 변경한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chmod 400 [키 페어 파일 이름]</span><br></pre></td></tr></table></figure>
</li>
<li><p>키 페어 파일을 .ssh 폴더에 보관하기 위해 파일을 이동시킨다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mv [키 페어 파일 이름] ~/.ssh/</span><br></pre></td></tr></table></figure>
</li>
<li><p>ssh 명령어를 사용하여 서버에 접속해본다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -i ~/.ssh/[키페어 파일 이름] ubuntu@[EC2의 퍼블릭 DNS]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 신규 접속 시 정말로 접속할지 물어보면 yes를 입력하면 된다.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>접속에 성공하면 ubuntu shell이 나타난다.</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/21/190521-Django-Study/" data-id="cjyco4kr8009z31wu05b34nvi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190520-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/20/190520-Django-Study/" class="article-date">
  <time datetime="2019-05-20T10:54:33.000Z" itemprop="datePublished">2019-05-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/20/190520-Django-Study/">2019.05.20 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Django-Project-복습"><a href="#Django-Project-복습" class="headerlink" title="Django Project 복습"></a>Django Project 복습</h2><ul>
<li>프로젝트 만들기</li>
<li>가상 환경 만들기</li>
<li>데이터베이스 설정하기</li>
<li>S3 파일서버 설정하기</li>
<li>S3에 도메인 연결하기</li>
</ul>
<ol>
<li><p>PyCharm을 실행하여 새로운 프로젝트를 생성한다.</p>
<ul>
<li>“sample_project”로 생성</li>
<li><p>django 설치</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django</span><br></pre></td></tr></table></figure>
</li>
<li><p>django 프로젝트 생성</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ django-admin startproject config .</span><br></pre></td></tr></table></figure>
</li>
<li><p>의존성 리스트 생성</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip freeze &gt; requirements.txt</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>가상 환경을 만든다.</p>
<ul>
<li>프로젝트 생성 시, 가상환경을 자동으로 생성해준다.</li>
<li>자동으로 생성되지 않았을 때를 가정한다.</li>
<li><p>가상 환경 생성</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m virtualenv venv</span><br></pre></td></tr></table></figure>
</li>
<li><p>가상 환경 활성화</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> venv/bin/activate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 가상 환경 비활성화</span></span><br><span class="line">$ deactivate</span><br></pre></td></tr></table></figure>
</li>
<li><p>의존성 리스트를 이용한 패키지 설치</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>소스에서 모듈 명령어에 빨간줄이 있다면 File/Settings/Project:[현재 프로젝트]/Project Interpreter로 이동</p>
</li>
<li>오른쪽 끝 톱니바퀴 버튼을 누름</li>
<li>Show All을 선택하고 “+”를 눌러서 Virtualenv Environment/Existing environment 선택<ul>
<li>자동으로 현재 프로젝트 폴더에 있는 가상 환경을 찾아줌</li>
</ul>
</li>
<li>추가된 가상 환경을 선택하고 OK 버튼을 누름</li>
<li>선택한 인터프리터 이름과 설치된 모듈 목록들이 올바른지 확인</li>
</ul>
</li>
<li><p>데이터베이스를 설정한다.</p>
<ul>
<li>아마존 AWS 홈페이지로 접속해 [콘솔에 로그인]한다.</li>
<li>[서비스] 메뉴에서 데이터베이스/RDS를 누른다.</li>
<li>RDS에서 데이터베이스 생성을 누른다.<ul>
<li>PostgreSQL 선택 및 화면 하단의 RDS 프리티어에 적용되는 옵션만 사용에 체크</li>
<li>DB 엔진 버전은 PostgreSQL 10.6-R1 선택</li>
<li>DB 인스턴스 식별자와 사용자 계정 설정<ul>
<li>마스터 사용자 이름은 추후 확인할 방법이 없으므로 꼭 기억해야함</li>
</ul>
</li>
<li>퍼블릭 엑세스 가능성은 [예]로 선택<ul>
<li>실습 환경에서는 [예]를 선택하고, 프로덕션 환경에서는 꼭 [아니오]로 변경</li>
</ul>
</li>
<li>데이터베이스 이름 설정 및 백업 보존 기간 0일 설정<ul>
<li>실습 환경에서는 백업 비용을 없애기 위해 0일로 설정</li>
<li>대부분의 경우 1~2일 정도를 보관</li>
</ul>
</li>
<li>실수로 인스턴스가 삭제되는 것을 막기 위해 삭제 방지  활성화 체크</li>
<li>데이터베이스 생성</li>
</ul>
</li>
<li>DB 인스턴스 세부 정보 보기/VPC 보안 그룹으로 이동하여 인바운드를 설정한다.<ul>
<li>인바운드 : 외부에서 들어오는 접속에 대한 설정</li>
<li>아웃바운드 - 해당 인스턴스가 외부 어디에 접근할 수 있는지에 대한 설정</li>
<li>인바운드에서 편집/규칙 추가하여 포트 번호 입력 및 위치 무관 선택 후 저장<ul>
<li>프로덕션 환경에서는 절대 위치 무관을 선택해서는 안된다.</li>
<li>네트워크는 폐쇄적일수록 안전하다.</li>
</ul>
</li>
</ul>
</li>
<li><p>PyCharm 프로젝트에서 settings.py에 DATABASE 항목을 수정한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Database</span></span><br><span class="line"><span class="comment"># https://docs.djangoproject.com/en/2.2/ref/settings/#databases</span></span><br><span class="line"><span class="comment"># backends는 장고와 데이터베이스 어답터 사이를 연결해주는 역할</span></span><br><span class="line"><span class="comment"># psycopg2-binary : 어답터 - 드라이버 -&gt; 실제로 데이터베이스에 접속해서 명령을 수행하는 모듈</span></span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.postgresql_psycopg2'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'데이터베이스 이름'</span>,</span><br><span class="line">        <span class="string">'USER'</span>:<span class="string">'마스터 사용자 이름'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>:<span class="string">'마스터 사용자 비밀번호'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>:<span class="string">'아마존 RDS의 엔드포인트'</span>,</span><br><span class="line">        <span class="string">'POST'</span>:<span class="string">'데이터베이스 접속 포트번호'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># web service에서 가장 병목이 데이터베이스. 데이터베이스에서 가장 시간을 많이 사용한다.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>어답터 모듈 설치</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install psycopg2-binary</span><br></pre></td></tr></table></figure>
</li>
<li><p>데이터베이스 초기화</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py migrate</span><br></pre></td></tr></table></figure>
</li>
<li><p>관리자 계정 생성</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py createsuperuser</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>S3 파일서버를 설정한다.</p>
<ul>
<li>아마존 AWS 홈페이지에서 [서비스] 메뉴에서 스토리지/S3를 누른다.</li>
<li><p>S3에서 버킷 만들기를 누른다.</p>
<ul>
<li><p>버킷 이름을 입력하는데 도메인과 연결할 것이기 때문에 다음과 같이 설정한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[저장할 대상 이름].[프로젝트 이름].[도메인 이름]</span><br><span class="line">ex) static.sample.jinukk.me</span><br><span class="line">ex) media.sample.jinukk.me</span><br></pre></td></tr></table></figure>
</li>
<li><p>리전은 [아시아 태평양(서울)] 선택</p>
</li>
<li>퍼블릭 엑세스 차단 부분에서는 모든 퍼블릭 엑세스 차단의 체크를 해제<ul>
<li>클라이언트가 S3에 직접 접속해 파일을 받아가도록 할 것이기 때문</li>
<li>퍼블릭 엑세스가 가능한 상태이어야 함</li>
</ul>
</li>
<li>버킷을 만들고 생성된 버킷 확인</li>
</ul>
</li>
<li>django 프로젝트에서 S3를 이용하려면 아마존 사용 권한이 있어야 함<ul>
<li>[서비스] 메뉴에서 보안, 자격 증명 및 규정 준수/IAM을 누른다.</li>
<li>왼쪽 사용자 메뉴에서 사용자 추가를 눌러서 사용자 이름을 입력한다.</li>
<li>AWS 액세스 유형은 프로그래밍 방식 액세스를 선택한다.</li>
<li>권한 설정 부분에서는 그룹 생성을 누른 후, 그룹 이름을 입력한다.</li>
<li>정책 필더에는 AmazonS3FullAccess를 검색하여 체크하고 그룹을 생성한다.</li>
<li>태그와 검토 부분은 생략하고 사용자 만든다.</li>
<li>사용자 추가가 끝난 뒤 나오는 액세스 키는 다시 확인할 수 없다.<ul>
<li>반드시 [.csv 다운로드]를 눌러서 액세스 키를 다운받아 놓는다.</li>
</ul>
</li>
</ul>
</li>
<li><p>PyCharm 프로젝트에서 settings.py에 설정을 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">AWS_ACCESS_KEY_ID = <span class="string">'아마존 AWS 액세스 키'</span></span><br><span class="line">AWS_SECRET_ACCESS_KEY = <span class="string">'아마존 AWS 비밀 액세스 키'</span></span><br><span class="line"></span><br><span class="line">AWS_REGION = <span class="string">'ap-northeast-2'</span></span><br><span class="line">AWS_STORAGE_BUCKET_NAME = <span class="string">'static.sample.jinukk.me'</span></span><br><span class="line"></span><br><span class="line">AWS_S3_CUSTOM_DOMAIN = <span class="string">'s3.%s.amazonaws.com/%s'</span> % (AWS_REGION, AWS_STORAGE_BUCKET_NAME)</span><br><span class="line"></span><br><span class="line">AWS_S3_FILE_OVERWRITE = <span class="literal">False</span></span><br><span class="line"><span class="comment"># True일 경우 같은 파일을 올렸을 때 덮어씌워진다.</span></span><br><span class="line"><span class="comment"># False를 하면 같은 파일이 올라와도 덮어씌워지지 않게 파일 이름을 자동으로 바꿔줌</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 브라우저가 해당 파일에 접속 했을 때 나타나는 파라미터 값</span></span><br><span class="line">AWS_S3_OBJECT_PARAMETERS = &#123;</span><br><span class="line"><span class="string">'CacheControl'</span>: <span class="string">'max-age=86400'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 지금올리는 파일의 권한을 지정해줌</span></span><br><span class="line">AWS_DEFAULT_ACL = <span class="string">'public-read'</span></span><br><span class="line"></span><br><span class="line">AWS_LOCATION = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">'https://%s/%s/'</span> % (AWS_S3_CUSTOM_DOMAIN, AWS_LOCATION)</span><br><span class="line">STATICFILES_STORAGE = <span class="string">'storages.backends.s3boto3.S3Boto3Storage'</span></span><br><span class="line"><span class="comment"># S3Boto와 S3Boto3는 지금 같이 사용할 수 있지만 S3Boto는 곧 사라지기 떄문에 S3Boto3를 사용</span></span><br><span class="line"><span class="comment"># 쓰던 방식을 계속 쓰는 것이 문제 - 의존성 패키지 목록 관리</span></span><br><span class="line"><span class="comment"># Django 1.8이 LTS</span></span><br><span class="line"><span class="comment"># Django 2.2 -&gt; LTS -&gt; Long Tern Service</span></span><br><span class="line"><span class="comment"># 로거를 사용해서 로그를 s3에 있는 파일에 업로드</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>장고 프로젝트에서 S3를 사용하기 위해 모듈 설치</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django-storages</span><br><span class="line"></span><br><span class="line">$ pip install boto3</span><br></pre></td></tr></table></figure>
</li>
<li><p>프로젝트에 포함된 스테틱 파일들을 S3에 업로드</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py collectstatic</span><br></pre></td></tr></table></figure>
</li>
<li><p>AWS 홈페이지의 S3에서 static 파일이 업로드되었는지 해당 버킷에서 확인</p>
</li>
<li><p>미디어 파일도 설정하기 위해 settings.py에 설정 추가</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># storages.backends.s3boto3.S3Boto3Storage를 사용할 수 있지만</span></span><br><span class="line"><span class="comment"># static 파일과 같은 경로에서 관리되기 때문에 미디어 파일을 별도로 분리하고 싶다면 스토리지 모듈을 별도로 상속받아 변경한다.</span></span><br><span class="line">DEFAULT_FILE_STORAGE = <span class="string">'config.s3media.MediaStorage'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>config/s3media.py를 생성</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> storages.backends.s3boto3 <span class="keyword">import</span> S3Boto3Storage</span><br><span class="line"></span><br><span class="line"><span class="comment"># 기본 설정값을 오버라이드 하기 위해서 S3Boto3Storage를 상속한다.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MediaStorage</span><span class="params">(S3Boto3Storage)</span>:</span></span><br><span class="line">    <span class="comment"># 업로드될 버킷</span></span><br><span class="line">    bucket_name = <span class="string">'media.sample.jinukk.me'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 업로드될 버킷 하위의 폴더이름</span></span><br><span class="line">    location = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 버킷이 존재하는 리전</span></span><br><span class="line">    region_name = <span class="string">'ap-northeast-2'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 실제로 파일에 접속할 때 사용할 주소</span></span><br><span class="line">    <span class="comment"># 직접 파일을 올려보고 주소를 확인하자.</span></span><br><span class="line">    custom_domain = <span class="string">'https://%s/%s/'</span> % (region_name, bucket_name)</span><br><span class="line">    file_overwrite = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>미디어 파일 테스트를 위해 간단한 모델을 만들고 관리자 페이지에서 이미지 업로드</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sample</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    image = models.ImageField(upload_to=<span class="string">'sample/%Y/%m/%d'</span>, blank=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># admin.py</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Sample</span><br><span class="line"></span><br><span class="line">admin.site.register(Sample)</span><br></pre></td></tr></table></figure>
</li>
<li><p>관리자 페이지에서 이미지를 업로드해보고 AWS에서 해당 버킷에 업로드되었는지 확인</p>
</li>
</ul>
</li>
<li><p>S3에 도메인을 연결한다.</p>
<ul>
<li>파일 주소에 S3임이 노출되기 때문에 도메인을 연결하여 사용한다.</li>
<li>반드시 버킷 이름과 도메인이 동일해야 한다.</li>
<li>버킷을 처음 만들 때부터 도메인을 염두에 두고 만들자.</li>
<li>[서비스] 메뉴에서 스토리지/S3로 이동하여 설정할 버킷 이름을 누른다.<ul>
<li>속성 탭을 클릭하여 정적 웹 사이트 호스팅을 활성화 상태로 변경한다.</li>
<li>[이 버킷을 사용하여 웹 사이트를 호스팅합니다.]를 누름</li>
<li>index.html과 error.html을 입력하고 저장을 누름</li>
<li>버킷 호스팅이 활성화되었는지 확인</li>
</ul>
</li>
<li>[서비스] 메뉴에서 네트워크 및 콘텐츠 전송/Route 53으로 이동한다.<ul>
<li>DNS 관리에서 호스팅 영역을 누른다.</li>
<li>S3에서 사용할 도메인을 누르고 레코드 세트 생성을 누른다.</li>
<li>레코드 세트 생성 창에서 S3 버킷과 동일한 이름으로 설정한다.</li>
<li>유형은 [A - IPv4] 주소를 선택한다.</li>
<li>별칭은 [예]를 선택하고 별칭 대상 목록에 나타난 S3 버킷을 선택하고 생성한다.<ul>
<li>static과 media 모두 생성하도록 한다.</li>
</ul>
</li>
<li>레코드 목록에 잘 나타나는지 확인한다.</li>
</ul>
</li>
<li><p>PyCharm 프로젝트에서 settings.py에 설정을 변경한다.</p>
<ul>
<li>주소 자체가 버킷 이름과 같아지기 때문에 버킷 이름을 변경한다.</li>
<li>S3 단독으로는 https를 사용할 수 없기 때문에 http로 변강하는 설정값을 추가한다.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AWS_S3_CUSTOM_DOMAIN = AWS_STORAGE_BUCKET_NAME</span><br><span class="line"><span class="comment"># https가 아니라 http로 주소를 노출하기 위해 사용</span></span><br><span class="line">AWS_S3_SECURE_URLS = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>config/s3media.py도 수정</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">custom_domain = bucket_name</span><br></pre></td></tr></table></figure>
</li>
<li><p>이미지 주소를 입력하여 잘 나오는지 확인</p>
</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/20/190520-Django-Study/" data-id="cjyco4kr900a131wu4i9s4zre" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190517-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/17/190517-Django-Study/" class="article-date">
  <time datetime="2019-05-17T11:26:06.000Z" itemprop="datePublished">2019-05-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/17/190517-Django-Study/">2019.05.17 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Board-project"><a href="#Board-project" class="headerlink" title="[ Board project ]"></a>[ Board project ]</h2><ul>
<li><p>AJAX</p>
<ul>
<li>비동기식 JavaScript와 XML(Asynchronos Javascript And XML)</li>
<li>JavaScript를 통해서 서버에 데이터를 요청</li>
<li>서버에 로딩된 데이터를 페이지에 보여주기 위해 새로운 HTML 페이지로 가지 않음</li>
<li>ajax를 통해 주로 주고 받는 형태가 XML이나 JSON</li>
</ul>
</li>
<li><p>댓글 기능에 AJAX 적용하기</p>
<ol>
<li><p>버튼을 통해 데이터 가져오기</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py에 추가</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">일반적인 경우 데이터를 전송하기 위해 json 사용</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data_ajax</span><span class="params">(request)</span>:</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">"name"</span>:<span class="string">'Jake'</span>,</span><br><span class="line">        <span class="string">"age"</span>:<span class="number">100</span>,</span><br><span class="line">        <span class="string">"bloodtype"</span>:<span class="string">"0"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># urls.py에 추가</span></span><br><span class="line"><span class="keyword">from</span> .views <span class="keyword">import</span> get_data_ajax</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'ajax/get_data/'</span>, get_data_ajax, name=<span class="string">'get_data_ajax'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--// board_project/layout/base.html //--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--// </span></span><br><span class="line"><span class="comment">bootstrap JS 적용에서 3개의 Script 중에 첫번째 Script 교체 적용</span></span><br><span class="line"><span class="comment">jQuery.com - Download - google CDN - jQuery/3.x snippet의 내용 작성</span></span><br><span class="line"><span class="comment">//--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--// board_project/board/templates/board/document_list.html //--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Document List</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-12"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></span><br><span class="line">            &#123;% for object in object_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.author.username&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.updated&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--// 데이터가 표시될 곳 지정 //--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"data_area"</span>&gt;</span></span><br><span class="line">            데이터가 입력될 곳</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--// url 연결 //--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:get_data_ajax' %&#125;"</span> <span class="attr">class</span>=<span class="string">"btn_get_data btn btn-primary"</span>&gt;</span>데이터 가져오기<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">aria-label</span>=<span class="string">"Page navigation example"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination justify-content-center"</span>&gt;</span></span><br><span class="line">                &#123;% for page in page_range %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"page-item"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"page-link"</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:list' %&#125;?page=&#123;&#123;page&#125;&#125;"</span>&gt;</span>&#123;&#123;page&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">id</span>=<span class="string">"search_form"</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            &#123;%csrf_token%&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-row align-items-center justify-content-center"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"search_type"</span> <span class="attr">id</span>=<span class="string">"inlineCheckbox1"</span> <span class="attr">value</span>=<span class="string">"author"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span> <span class="attr">for</span>=<span class="string">"inlineCheckbox1"</span>&gt;</span>작성자<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"search_type"</span> <span class="attr">id</span>=<span class="string">"inlineCheckbox2"</span> <span class="attr">value</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span> <span class="attr">for</span>=<span class="string">"inlineCheckbox2"</span>&gt;</span>제목<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"search_type"</span> <span class="attr">id</span>=<span class="string">"inlineCheckbox3"</span> <span class="attr">value</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span> <span class="attr">for</span>=<span class="string">"inlineCheckbox3"</span>&gt;</span>본문<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-row align-items-center justify-content-center"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-3 my-1"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span>, <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Search Keyword"</span> <span class="attr">name</span>=<span class="string">"search_key"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-auto my-1"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block extra_script %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">// 1. 버튼을 누르면 페이지 이동이 안되도록</span></span><br><span class="line"><span class="undefined">// 2. 데이터를 가져오기</span></span><br><span class="line"><span class="undefined">$(function()&#123;</span></span><br><span class="line"><span class="undefined">    // 페이지 로딩이 끝나면 할일들</span></span><br><span class="line"><span class="undefined">    $('.btn_get_data').click(function(e)&#123;</span></span><br><span class="line"><span class="undefined">        e.preventDefault(); // 버튼을 클릭하면 이동 못하게 기본 기능 취소</span></span><br><span class="line"><span class="undefined">        //alert('clicked'); // 확인을 위해 알림창 띄우기</span></span><br><span class="line"><span class="undefined">        url = $(this).attr('href');</span></span><br><span class="line"><span class="undefined">        $.ajax(&#123;</span></span><br><span class="line"><span class="undefined">            // ajax 호출이 사용할 매개변수</span></span><br><span class="line"><span class="undefined">            url:url</span></span><br><span class="line"><span class="undefined">        &#125;).done(function(data)&#123;</span></span><br><span class="line"><span class="undefined">            // 호출이 끝나면 받은 데이터를 처리하는 부분</span></span><br><span class="line"><span class="undefined">            name = data.name;</span></span><br><span class="line"><span class="undefined">            age = data.age;</span></span><br><span class="line"><span class="undefined">            bloodtype = data.bloodtype</span></span><br><span class="line"><span class="undefined">            //alert(data.bloodtype);</span></span><br><span class="line"><span class="xml">            html = "<span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>"+name+"<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>"+age+"<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>"+bloodtype+"<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span>";</span></span><br><span class="line"><span class="undefined">            $('.data_area').html(html);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>댓글 기능에 ajax 적용</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py에 추가</span></span><br><span class="line"><span class="keyword">from</span> django.template.loader <span class="keyword">import</span> render_to_string</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">comment_create</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    <span class="comment"># ajax 기능에 의해 호출된 것인지 구분하기 위한 값</span></span><br><span class="line">    is_ajax = request.POST.get(<span class="string">'is_ajax'</span>)</span><br><span class="line"></span><br><span class="line">    document = get_object_or_404(Document, pk=document_id)</span><br><span class="line">    comment_form = CommentForm(request.POST)</span><br><span class="line">    comment_form.instance.author_id = request.user.id</span><br><span class="line">    comment_form.instance.document_id = document_id</span><br><span class="line">    <span class="keyword">if</span> comment_form.is_valid():</span><br><span class="line">        comment = comment_form.save()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 만약 ajax에 의해 호출되었다면 redirection없이 Json 형태로 응답</span></span><br><span class="line">    <span class="keyword">if</span> is_ajax:</span><br><span class="line">        <span class="comment"># 데이터를 만들어서 던져주기</span></span><br><span class="line">        html = render_to_string(<span class="string">'board/comment/comment_single.html'</span>,&#123;<span class="string">'comment'</span>:comment&#125;)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'html'</span>:html&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(document)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> messages</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">comment_update</span><span class="params">(request, comment_id)</span>:</span></span><br><span class="line">    <span class="comment"># GET과 POST를 구분</span></span><br><span class="line">    is_ajax, data = (request.GET.get(<span class="string">'is_ajax'</span>), request.GET) <span class="keyword">if</span> <span class="string">'is_ajax'</span> <span class="keyword">in</span> request.GET \</span><br><span class="line">        <span class="keyword">else</span> (request.POST.get(<span class="string">'is_ajax'</span>, <span class="literal">False</span>), request.POST)</span><br><span class="line"></span><br><span class="line">    comment = get_object_or_404(Comment, pk=comment_id)</span><br><span class="line">    document = get_object_or_404(Document, pk=comment.document.id)</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span> request.user != comment.author:</span><br><span class="line">        messages.warning(request, <span class="string">"권한 없음"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(document)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ajax에 의해 호출될 때 응답</span></span><br><span class="line">    <span class="keyword">if</span> is_ajax:</span><br><span class="line">        form = CommentForm(data, instance=comment)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.save()</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'works'</span>:<span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        form = CommentForm(request.POST, instance=comment)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.save()</span><br><span class="line">            <span class="keyword">return</span> redirect(document)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = CommentForm(instance=comment)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/comment/update.html'</span>, &#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">comment_delete</span><span class="params">(request, comment_id)</span>:</span></span><br><span class="line">    <span class="comment"># GET과 POST를 구분</span></span><br><span class="line">    is_ajax = request.GET.get(<span class="string">'is_ajax'</span>) <span class="keyword">if</span> <span class="string">'is_ajax'</span> <span class="keyword">in</span> request.GET <span class="keyword">else</span> request.POST.get(<span class="string">'is_ajax'</span>, <span class="literal">False</span>)</span><br><span class="line">    comment = get_object_or_404(Comment, pk=comment_id)</span><br><span class="line">    document = get_object_or_404(Document, pk=comment.document.id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.user != comment.author <span class="keyword">and</span> <span class="keyword">not</span> request.user.is_staff <span class="keyword">and</span> request.user != document.author:</span><br><span class="line">        messages.warning(request, <span class="string">"권한 없음"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(document)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ajax에 의해 호출될 때 응답</span></span><br><span class="line">    <span class="keyword">if</span> is_ajax:</span><br><span class="line">        comment.delete()</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'works'</span>:<span class="literal">True</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        comment.delete()</span><br><span class="line">        <span class="keyword">return</span> redirect(document)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'board/comment/delete.html'</span>, &#123;<span class="string">'object'</span>:comment&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--// board_project/board/templates/board/document_detail.html //--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Document Detail</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">        &#123;&#123;object.title&#125;&#125; &#123;&#123;object.text&#125;&#125; &#123;&#123;object.image.url&#125;&#125; &#123;&#123;object.author.username&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--// form에 id 추가 //--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"&#123;% url 'board:comment_create' object.id %&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">id</span>=<span class="string">"comment_form"</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"is_ajax"</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            &#123;&#123;comment_form.as_p&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Comment"</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-primary"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"docs_comment_list_area"</span>&gt;</span></span><br><span class="line">            &#123;% include 'board/comment_list.html' %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block extra_script %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">// 댓글의 생성, 수정, 삭제에 대한 script 추가</span></span><br><span class="line"><span class="undefined">    $(function() &#123;</span></span><br><span class="line"><span class="undefined">        // 1. 누구한테 이벤트를 설정할 것인가?</span></span><br><span class="line"><span class="undefined">        // 2. 어떤 이벤트를 설정할 것인가?</span></span><br><span class="line"><span class="undefined">        $('#comment_form').submit(function(e) &#123;</span></span><br><span class="line"><span class="undefined">            // alert('댓글 쓰기 완료');</span></span><br><span class="line"><span class="undefined">            // 댓글 남기기</span></span><br><span class="line"><span class="undefined">            $('input[name="is_ajax"]').val("1");</span></span><br><span class="line"><span class="undefined">            url = $(this).attr('action');</span></span><br><span class="line"><span class="undefined">            params = $(this).serialize(); // 전달해주는 데이터들을 하나로 합침</span></span><br><span class="line"><span class="undefined">            $.ajax(&#123;</span></span><br><span class="line"><span class="undefined">                url:url,</span></span><br><span class="line"><span class="undefined">                method:"POST",</span></span><br><span class="line"><span class="undefined">                data:params</span></span><br><span class="line"><span class="undefined">            &#125;).done(function(data) &#123;</span></span><br><span class="line"><span class="undefined">                // 댓글 입력창 내용 비우기</span></span><br><span class="line"><span class="undefined">                $('#id_text').val("");</span></span><br><span class="line"><span class="undefined">                $('#comment_list tbody').prepend(data.html); // tbody 시작 지점에 요소 끼워넣기</span></span><br><span class="line"><span class="undefined">                // $('#comment_list tbody').append(tr); // tbody 끝 지점에 요소 끼워넣기</span></span><br><span class="line"><span class="undefined">                // is_ajax 값 초기화</span></span><br><span class="line"><span class="undefined">                $('input[name="is_ajax"]').val("");</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">            return false;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        $('.btn_comment_delete').click(function(e) &#123;</span></span><br><span class="line"><span class="undefined">            e.preventDefault();</span></span><br><span class="line"><span class="undefined">            var input = confirm('댓글을 삭제하시겠습니까?');</span></span><br><span class="line"><span class="undefined">            if (input==true) &#123;</span></span><br><span class="line"><span class="undefined">                alert('댓글을 삭제하였습니다.');</span></span><br><span class="line"><span class="undefined">                // ajax 호출</span></span><br><span class="line"><span class="undefined">                comment = $(this).parents('tr');</span></span><br><span class="line"><span class="undefined">                url = $(this).attr('href')+"?is_ajax=1";</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">                $.ajax(&#123;</span></span><br><span class="line"><span class="undefined">                    url:url</span></span><br><span class="line"><span class="undefined">                &#125;).done(function(data) &#123;</span></span><br><span class="line"><span class="undefined">                    if(data.works) &#123;</span></span><br><span class="line"><span class="undefined">                        comment.remove(); // 해당 객체 지우기</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        $('.btn_comment_update').click(function(e) &#123;</span></span><br><span class="line"><span class="undefined">            e.preventDefault();</span></span><br><span class="line"><span class="undefined">            url = $(this).attr('href')+"?is_ajax=1";</span></span><br><span class="line"><span class="undefined">            comment = $(this).parent().siblings('.comment_text'); // 원래 댓글을 찾음</span></span><br><span class="line"><span class="undefined">            //text = prompt('수정될 댓글 내용을 입력하세요.', comment.text()); // 원래 댓글을 프롬프트로 보여줌</span></span><br><span class="line"><span class="undefined">            //if(text==null) return false; // 입력 취소면 함수 종료</span></span><br><span class="line"><span class="xml">            input = "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'text'</span> <span class="attr">class</span>=<span class="string">'update_text'</span> <span class="attr">value</span>=<span class="string">'"+comment.text()+"'</span>&gt;</span>";</span></span><br><span class="line"><span class="undefined">            comment.html(input);</span></span><br><span class="line"><span class="undefined">            $('.update_text').keypress(function(e)&#123;</span></span><br><span class="line"><span class="undefined">                if(e.keyCode==13) &#123;   // 키보드 Enter에 대한 키 값 설정</span></span><br><span class="line"><span class="undefined">                    text = $(this).val();</span></span><br><span class="line"><span class="undefined">                    $.ajax(&#123;</span></span><br><span class="line"><span class="undefined">                        url:url,</span></span><br><span class="line"><span class="undefined">                        data:&#123;</span></span><br><span class="line"><span class="undefined">                        text:text</span></span><br><span class="line"><span class="undefined">                        &#125;</span></span><br><span class="line"><span class="undefined">                    &#125;).done(function(data) &#123;</span></span><br><span class="line"><span class="undefined">                        // 댓글 수정이 끝나면 할 일</span></span><br><span class="line"><span class="undefined">                        if(data.works) &#123;</span></span><br><span class="line"><span class="undefined">                            comment.text(text);</span></span><br><span class="line"><span class="undefined">                        &#125;</span></span><br><span class="line"><span class="undefined">                    &#125;);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--// board_project/board/templates/board/comment_list.html //--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--// table에 id 추가//--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-strped"</span> <span class="attr">id</span>=<span class="string">"comment_list"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"3"</span> <span class="attr">class</span>=<span class="string">"align-left"</span>&gt;</span>댓글 목록<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">    &#123;% for comment in comments %&#125;</span><br><span class="line">        <span class="comment">&lt;!--// include를 통해 겹치는 구문 제거 //--&gt;</span></span><br><span class="line">        &#123;% include 'board/comment/comment_single.html' %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--// board_project/board/templates/board/comment_list.html //--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--// tr 문에 class 이름 추가 //--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span> <span class="attr">class</span>=<span class="string">"comment_row"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--// 해당 td 문에 class 이름 추가 //--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"3"</span> <span class="attr">class</span>=<span class="string">"comment_text"</span>&gt;</span>&#123;&#123;comment.text&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;comment.author.username&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;comment.created&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:comment_update' comment.id %&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-dark btn-sm btn_comment_update"</span>&gt;</span>Update<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:comment_delete' comment.id %&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-danger btn0sm btn_comment_delete"</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/17/190517-Django-Study/" data-id="cjyco4kr900a331wuemvwykif" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190516-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/16/190516-Django-Study/" class="article-date">
  <time datetime="2019-05-16T12:45:36.000Z" itemprop="datePublished">2019-05-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/16/190516-Django-Study/">2019.05.16 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Board-project"><a href="#Board-project" class="headerlink" title="[ Board project ]"></a>[ Board project ]</h2><ul>
<li><p>댓글 기능 적용</p>
<ol>
<li><p>models.py에 comment 모델 작성</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># Todo : 댓글 남기기를 위해서 Form</span></span><br><span class="line">    <span class="comment"># Todo : 뷰 처리는 Documents의 뷰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 해당 게시글의 댓글이기 때문에 document라는 ForeignKey 적용</span></span><br><span class="line">    document = models.ForeignKey(Document, on_delete=models.CASCADE, related_name=<span class="string">'comments'</span>)</span><br><span class="line">    author = models.ForeignKey(get_user_model(), on_delete=models.SET_NULL,</span><br><span class="line">                            null=<span class="literal">True</span>, blank=<span class="literal">True</span>, related_name=<span class="string">'comments'</span>)</span><br><span class="line">    text = models.TextField()</span><br><span class="line">    created = models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated = models.DateTimeField(auto_now=<span class="literal">True</span>)</span><br><span class="line">    like = models.IntegerField(default=<span class="number">0</span>) <span class="comment"># ManyToMany</span></span><br><span class="line">    dislike = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.author.username <span class="keyword">if</span> self.author <span class="keyword">else</span> <span class="string">"무명"</span>) +<span class="string">"의 댓글"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># makemigrations와 migrate를 실행하자.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>forms.py 작성</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentForm</span><span class="params">(forms.ModelForm)</span>:</span></span><br><span class="line">    <span class="comment"># text = forms.TextInput(label="댓글")</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        model = Comment</span><br><span class="line">        fields = [<span class="string">'text'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        super().__init__(*args, **kwargs)</span><br><span class="line">        self.fields[<span class="string">'text'</span>].label = <span class="string">"댓글"</span></span><br><span class="line">        self.fields[<span class="string">'text'</span>].widget = forms.TextInput()</span><br><span class="line">        self.fields[<span class="string">'text'</span>].widget.attrs = &#123;<span class="string">'class'</span>: <span class="string">"form-control"</span>,</span><br><span class="line">                                            <span class="string">'placeholder'</span>:<span class="string">"댓글을 입력하세요"</span>&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>views.py 작성</p>
</li>
</ol>
<ul>
<li>페이지에 접근했을 때 구동되는 로직들<ul>
<li>함수형 뷰(Function Based View)<ol>
<li>해당 객체가 있는지 확인(get_object_or_404, object.filter.exists)</li>
<li>객체에 대한 권한 체크 - 작성자, 관리자</li>
<li>get, post<ul>
<li>get : 해당 페이지에 필요한 값 입력 받기</li>
<li>post : 입력받은 값에 대한 처리 -&gt; 삭제, 업데이트</li>
</ul>
</li>
<li>처리 후 페이지 이동</li>
</ol>
</li>
<li>클래스형 뷰(Class Based View)<ol>
<li>객체에 대한 권한 체크(dispatch) - 작성자, 관리자</li>
<li>해당 객체가 있는지 확인(get_object, get_queryset)</li>
<li>get, post<ul>
<li>get : 해당 페이지에 필요한 값 입력 받기</li>
<li>post : 입력 받은 값에 대한 처리 -&gt; 삭제, 업데이트</li>
</ul>
</li>
<li>처리 후 페이지 이동</li>
</ol>
</li>
</ul>
</li>
<li>함수형 뷰와 클래스형 뷰의 로직이 다른 것은 아니다.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment 모델 추가</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Board, Category, Document, PhoneNumber, Comment</span><br><span class="line"></span><br><span class="line"><span class="comment"># 접근 권한의 메시지 출력을 위한 messages 모듈 추가</span></span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> messages</span><br><span class="line"></span><br><span class="line"><span class="comment"># comment 생성 뷰 추가</span></span><br><span class="line"><span class="comment"># detail 부분에서 comment를 생성하는 부분을 나눔</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">comment_create</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    document = get_object_or_404(Document, pk=document_id)</span><br><span class="line">    comment_form = CommentForm(request.POST)</span><br><span class="line">    <span class="comment"># 작성자 = 현재 로그인 사용자</span></span><br><span class="line">    comment_form.instance.author_id = request.user.id</span><br><span class="line">    <span class="comment"># 댓글을 달고 있는 게시글 = 현재 보고 있는 게시글</span></span><br><span class="line">    comment_form.instance.document_id = document_id</span><br><span class="line">    <span class="keyword">if</span> comment_form.is_valid():</span><br><span class="line">        comment = comment_form.save()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># redirect(reverse('board:detail', args=[document_id]))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># models.py의 document에서 get_absolute_url()을 지정</span></span><br><span class="line">    <span class="keyword">return</span> redirect(document)</span><br><span class="line"></span><br><span class="line"><span class="comment"># comment 수정 뷰 추가</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">comment_update</span><span class="params">(request, comment_id)</span>:</span></span><br><span class="line">    <span class="comment"># 수정할 comment</span></span><br><span class="line">    comment = get_object_or_404(Comment, pk=comment_id)</span><br><span class="line">    <span class="comment"># 수정할 cooment의 게시글</span></span><br><span class="line">    document = get_object_or_404(Document, pk=comment.document.id)</span><br><span class="line">    <span class="comment"># user.is_staff</span></span><br><span class="line">    <span class="comment"># user.is_superuser</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 현재 로그인 사용자가 comment의 작성자가 아니라면</span></span><br><span class="line">    <span class="keyword">if</span> request.user != comment.author:</span><br><span class="line">        <span class="comment"># '권한 없음'이라는 메시지 출력</span></span><br><span class="line">        messages.warning(request, <span class="string">"권한 없음"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(document)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="comment"># instance를 추가해야 새로 생성하는 것이 아닌 update인 것을 알 수 있다.</span></span><br><span class="line">        form = CommentForm(request.POST, instance=comment)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            form.save()</span><br><span class="line">            <span class="keyword">return</span> redirect(document)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = CommentForm(instance=comment)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/comment/update.html'</span>, &#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># comment 삭제 뷰 추가</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">comment_delete</span><span class="params">(request, comment_id)</span>:</span></span><br><span class="line">    comment = get_object_or_404(Comment, pk=comment_id)</span><br><span class="line">    document = get_object_or_404(Document, pk=comment.document.id)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 조건</span></span><br><span class="line">    <span class="comment"># 1. 현재 로그인한 사용자가 comment 작성자가 아님</span></span><br><span class="line">    <span class="comment"># 2. 현재 로그인한 사용자가 관리자 권한이 아님</span></span><br><span class="line">    <span class="comment"># 3. 현재 로그인한 사용자가 게시글의 작성자가 아님</span></span><br><span class="line">    <span class="keyword">if</span> request.user != comment.author <span class="keyword">and</span> <span class="keyword">not</span> request.user.is_staff <span class="keyword">and</span> request.user != document.author:</span><br><span class="line">        messages.warning(request, <span class="string">"권한 없음"</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(document)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        comment.delete()</span><br><span class="line">        <span class="keyword">return</span> redirect(document)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'board/comment/delete.html'</span>, &#123;<span class="string">'object'</span>:comment&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># detail 페이지에서 comment 동작 처리</span></span><br><span class="line"><span class="comment"># comment 생성을 처리할 수 있으나, comment_create라는 함수형 뷰를 따로 작성</span></span><br><span class="line"><span class="comment"># detail와 연결된 tmplate 파일 안에서 comment를 생성하는 template 파일 부분을 나눔</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_detail</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    <span class="comment"># document = Document.objects.get(pk=document_id)</span></span><br><span class="line">    document = get_object_or_404(Document, pk=document_id)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 만약 post일 때만 댓글 입력에 관한 처리를 더한다.</span></span><br><span class="line">    <span class="comment"># if request.method == "POST":</span></span><br><span class="line">    <span class="comment">#     comment_form = CommentForm(request.POST)</span></span><br><span class="line">    <span class="comment">#     comment_form.instance.author_id = request.user.id</span></span><br><span class="line">    <span class="comment">#     comment_form.instance.document_id = document_id</span></span><br><span class="line">    <span class="comment">#     if comment_form.is_valid():</span></span><br><span class="line">    <span class="comment">#         comment = comment_form.save()</span></span><br><span class="line"></span><br><span class="line">    comment_form = CommentForm()</span><br><span class="line">    <span class="comment"># 현재 보고 있는 게시글의 comments들을 모두 불러옴</span></span><br><span class="line">    comments = document.comments.all() <span class="comment"># document 입장에서의 comments</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_detail.html'</span>, &#123;<span class="string">'object'</span>:document,</span><br><span class="line">                                                        <span class="string">'comments'</span>:comments,</span><br><span class="line">                                                        <span class="string">'comment_form'</span>:comment_form&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="4">
<li><p>board/urls.py 작성</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 아래 항목 추가</span></span><br><span class="line">    <span class="comment"># comment 생성 관련</span></span><br><span class="line">    path(<span class="string">'create/&lt;int:document_id&gt;/'</span>, comment_create, name=<span class="string">'comment_create'</span>),</span><br><span class="line">    <span class="comment"># comment 수정 관련</span></span><br><span class="line">    path(<span class="string">'comment/update/&lt;int:comment_id&gt;/'</span>, comment_update, name=<span class="string">'comment_update'</span>),</span><br><span class="line">    <span class="comment"># comment 삭제 관련</span></span><br><span class="line">    path(<span class="string">'comment/delete/&lt;int:comment_id&gt;/'</span>, comment_delete, name=<span class="string">'comment_delete'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>template 파일 작성</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--// templates/board/document_detail.html //--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Photo Detail</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">        &#123;&#123;object.title&#125;&#125; &#123;&#123;object.text&#125;&#125; &#123;&#123;object.image.url&#125;&#125; &#123;&#123;object.author.username&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--// action에 comment_create 지정 //--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"&#123;% url 'board:comment_create' object.id %&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            &#123;&#123;comment_form.as_p&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Comment"</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-primary"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--// comment_list.html 적용 //--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"docs_comment_list_area"</span>&gt;</span></span><br><span class="line">            &#123;% include 'board/comment_list.html' %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--// templates/board/comment_list.html //--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-strped"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span> <span class="attr">colspan</span>=<span class="string">"3"</span> <span class="attr">class</span>=<span class="string">"align-left"</span>&gt;</span>댓글 목록<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    &#123;% for comment in comments %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;comment.text&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;comment.author.username&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;comment.created&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:comment_update' comment.id %&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-primary"</span>&gt;</span>Update<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:comment_delete' comment.id %&#125;"</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-danger"</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--// templates/board/comment/update.html //--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Board Create</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            &#123;&#123;form.as_p&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Update"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--// templates/board/comment/delete.html //--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Board Create</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"alert alert-info"</span>&gt;</span>Do you want to delete &#123;&#123;object&#125;&#125;?<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Delete"</span> <span class="attr">class</span>=<span class="string">"btn btn-outline-danger"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>admin.py 작성</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Comment 추가</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Board,Category,Document,PhoneNumber, Comment</span><br><span class="line"></span><br><span class="line"><span class="comment"># TabularInline 적용</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommentInline</span><span class="params">(admin.TabularInline)</span>:</span></span><br><span class="line">    model = Comment</span><br><span class="line"></span><br><span class="line"><span class="comment"># 관리자 페이지에서 ForeinKey로 연결된 데이터를 쉽게 관리하기 위해 추가</span></span><br><span class="line"><span class="comment"># 현재 게시글 안에서 댓글 데이터 관리 용이</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DocumentOption</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">list_display = [<span class="string">'id'</span>, <span class="string">'category'</span>, <span class="string">'author'</span>, <span class="string">'title'</span>, <span class="string">'slug'</span>, <span class="string">'created'</span>, <span class="string">'updated'</span>]</span><br><span class="line">prepopulated_fields = &#123;<span class="string">'slug'</span>:(<span class="string">'title'</span>,)&#125;</span><br><span class="line">inlines = [CommentInline]</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/16/190516-Django-Study/" data-id="cjyco4kr6009v31wu3aw7xbh4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190515-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/15/190515-Django-Study/" class="article-date">
  <time datetime="2019-05-15T07:56:18.000Z" itemprop="datePublished">2019-05-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/15/190515-Django-Study/">2019.05.15 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Board-project"><a href="#Board-project" class="headerlink" title="[ Board project ]"></a>[ Board project ]</h2><ul>
<li><p>F() 객체</p>
<ul>
<li>모델의 필드 값을 참조하여 데이터베이스 작업을 수행할 수 있다.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q, F</span><br><span class="line"><span class="keyword">from</span> board.models <span class="keyword">import</span> * <span class="comment"># Board, Category, Document</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 'title'이라는 문자열을 검색</span></span><br><span class="line">Document.objects.filter(title__icontains=<span class="string">'title'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 필드 값인 title을 참조하여 검색</span></span><br><span class="line">Document.objects.filter(title__icontains=F(<span class="string">'title'</span>))</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>selet_related()</p>
<ul>
<li>Join Query를 만들어서 한 큐에 데이터를 불러온다.</li>
<li>Join을 사용하기 때문에 ForeignKey와 같이 single valued relationships에서만 사용 가능하다.</li>
</ul>
</li>
<li>prefetch_related()<ul>
<li>모델 객체들을 불러서 코드 단에서 병합한다.</li>
<li>ManyToMany를 포함해서 모든 relationships에서 사용 가능하다.</li>
</ul>
</li>
<li>select_related()와 prefetch_related()를 사용하지 않는 경우<ul>
<li><strong>참조 테이블에 대한 데이터 질의를 항상 수행한다.</strong></li>
</ul>
</li>
<li><p>QuerySet Cache</p>
<ul>
<li><p>Query는 마지막까지 지연된다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q, F</span><br><span class="line"><span class="keyword">from</span> board.models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 아래 코드를 실행해도 DB에 쿼리는 수행되지 않는다.</span></span><br><span class="line">object_list = Document.objects.all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 아래와 같이 쿼리셋을 순회해야 쿼리가 수행된다.</span></span><br><span class="line"><span class="keyword">for</span> object <span class="keyword">in</span> object_list:</span><br><span class="line">    print(object.author.username)</span><br></pre></td></tr></table></figure>
</li>
<li><p>DB에 레코드들을 실제로 와서 Django model로 변환되는 것을 <strong>평가(evaluation)</strong>라고 한다.</p>
</li>
<li>평가된 모델들은 쿼리셋의 내장 캐시에 저장된다.</li>
<li>따라서 같은 쿼리셋을 재순회하더라도 DB에 전달하지 않는다.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 여기는 쿼리가 실행되지 않은 부분</span></span><br><span class="line">object_list = Document.objects.all()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 캐싱이 일어나지 않음</span></span><br><span class="line">object_list[<span class="number">4</span>]</span><br><span class="line"><span class="comment"># 캐싱이 일어나지 않음</span></span><br><span class="line">object_list[<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">object_list = Document.objects.all()</span><br><span class="line">[object.title <span class="keyword">for</span> object on object_list]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 캐싱이 일어남</span></span><br><span class="line">object_list[<span class="number">4</span>]</span><br><span class="line"><span class="comment"># 캐싱이 일어남</span></span><br><span class="line">object_list[<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 캐싱이 일어나지 않는다.</span></span><br><span class="line"><span class="comment"># Document.object.all()을 변수에 담아놓고 실행해야 한다.</span></span><br><span class="line"><span class="keyword">for</span> object <span class="keyword">in</span> Document.object.all():</span><br><span class="line">    print(object.title)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>exclude()</p>
<ul>
<li>특정 조건을 제외한 나머지 데이터들을 가져오기 위해 사용한다.</li>
<li>여러 조건들을 묶을 때에는 사용되지 않는다.</li>
</ul>
</li>
<li><p>정렬</p>
<ul>
<li><p>QuerySet의 기본 정렬값 = 모델에서 설정값</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Model:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        orderng = [<span class="string">'field name'</span>]</span><br></pre></td></tr></table></figure>
</li>
<li><p>기본 정렬값은 pk</p>
</li>
<li><p>오름차순(asc)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Document.objects.all().order_by(<span class="string">'title'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>내림차순(desc)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Document.objects.all().order_by(<span class="string">'-title'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>삭제</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Document.objects.get(pk=<span class="number">1</span>).delete()</span><br></pre></td></tr></table></figure>
</li>
<li><p>갱신</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Document.objects.get(pk=<span class="number">1</span>).update(title=<span class="string">"example"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 전체 레코드에 대한 갱신</span></span><br><span class="line">Document.objects.all().update(title=<span class="string">"example"</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__icontain=<span class="string">'word'</span>).update(title=<span class="string">"example"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>logging 사용하기</p>
<ul>
<li>setting.py에 추가한다.</li>
<li>터미널 창에서 쿼리문 출력을 확인한다.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">'version'</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="string">'disable_existing_loggers'</span>:<span class="literal">False</span>,</span><br><span class="line">    <span class="string">'handlers'</span>: &#123;</span><br><span class="line">        <span class="string">'console'</span>:&#123;</span><br><span class="line">            <span class="string">'class'</span>:<span class="string">'logging.StreamHandler'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'loggers'</span>:&#123;</span><br><span class="line">        <span class="string">'django'</span>:&#123;</span><br><span class="line">            <span class="string">'handlers'</span>:[<span class="string">'console'</span>],</span><br><span class="line">            <span class="string">'level'</span>:<span class="string">'DEBUG'</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">import logging</span></span><br><span class="line"><span class="string">l = logging.getLogger('django.db.backends')</span></span><br><span class="line"><span class="string">l.setLevel(logging.DEBUG)</span></span><br><span class="line"><span class="string">l.addHandler(logging.StreamHandler())</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>소셜 미디어 로그인 연동하기</p>
<ul>
<li>Django-allauth 사용<ul>
<li>django-allauth 문서 홈페이지로 이동하여 참고</li>
</ul>
</li>
<li>네이버 이용</li>
</ul>
<ol>
<li><p>해당 모듈을 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django-allauth</span><br></pre></td></tr></table></figure>
</li>
<li><p>settings.py를 수정한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'board'</span>,</span><br><span class="line">    <span class="string">'storages'</span>,</span><br><span class="line">    <span class="comment"># 항목 추가</span></span><br><span class="line">    <span class="string">'django.contrib.sites'</span>,</span><br><span class="line">    <span class="string">'allauth'</span>,</span><br><span class="line">    <span class="string">'allauth.account'</span>,</span><br><span class="line">    <span class="string">'allauth.socialaccount'</span>,</span><br><span class="line">    <span class="comment"># 네이버를 이용하기 위해 추가</span></span><br><span class="line">    <span class="string">'allauth.socialaccount.providers.naver'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 항목 추가</span></span><br><span class="line">AUTHENTICATION_BACKENDS = (</span><br><span class="line">    <span class="string">'django.contrib.auth.backends.ModelBackend'</span>,</span><br><span class="line">    <span class="string">'allauth.account.auth_backends.AuthenticationBackend'</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 추가</span></span><br><span class="line">SITE_ID = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 로그인 후에 이동할 경로 추가</span></span><br><span class="line">LOGIN_REDIRECT_URL = <span class="string">'/'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>config/urls.py에 경로를 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'accounts/'</span>, include(<span class="string">'allauth.urls'</span>)),</span><br></pre></td></tr></table></figure>
</li>
<li><p>migrate를 한다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py migrate</span><br></pre></td></tr></table></figure>
</li>
<li><p>django-allauth 문서 홈페이지에서 providers 탭에서 네이버 항목으로 이동한다.</p>
<ul>
<li><a href="https://developers.naver.com/appinfo" target="_blank" rel="noopener">https://developers.naver.com/appinfo</a> 로 이동한다.</li>
<li>애플리케이션을 등록한다.<ul>
<li>애플리케이션 이름을 작성한다.</li>
<li>사용 API는 네아로(네이버 아이디로 로그인)를 선택한다.</li>
<li>필수 항목에 회원이름과 이메일만 체크한다.<ul>
<li>나머지는 추가 항목으로 넣을 수 있다.</li>
</ul>
</li>
<li>환경은 PC웹을 선택하고 URL을 다음과 같이 설정한다.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- 서비스 URL</span><br><span class="line">&gt;&gt; http://127.0.0.1:8000</span><br><span class="line"></span><br><span class="line">- Callback URL</span><br><span class="line">- django-allauth 문서 홈페이지에서 providers 탭의 네이버 항목에 있다.</span><br><span class="line">&gt;&gt; http://127.0.0.1:8000/accounts/naver/login/callback/</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>서버를 실행하고 관리자 사이트로 접속하고, 소셜 어플리케이션을 추가한다.</p>
<ul>
<li>소셜 계정/소셜 어플리케이션/소셜 어플리케이션 추가<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">제공자 : Naver</span><br><span class="line">이름 : 네이버 로그인</span><br><span class="line">클라이언트 아이디 : 네이버 API 등록 시 발급되는 Client ID</span><br><span class="line">비밀 키 :  네이버 API 등록 시 발급되는 Client Secret</span><br><span class="line">sites : example.com 선택</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><a href="http://127.0.0.1:8000/account/login" target="_blank" rel="noopener">http://127.0.0.1:8000/account/login</a> 에 접속하여 naver를 누르고 로그인한다.</p>
<ul>
<li>admin으로 접속되어 있다면 로그아웃하자.</li>
<li>base.html에 로그인/로그아웃 URL을 추가하자.<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--// base.html //--&gt;</span></span><br><span class="line">&#123;% if user.is_authenticated %&#125;</span><br><span class="line"><span class="comment">&lt;!--// </span></span><br><span class="line"><span class="comment">django-allauth 문서 홈페이지/Views 탭에서 로그인, 로그아웃 URL 이름 확인</span></span><br><span class="line"><span class="comment"> //--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'account_logout' %&#125;"</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'account_login' %&#125;"</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>다시 관리자 페이지를 접속하여 소셜 계정에 등록되어 있는지 확인한다.</p>
<p><br></p>
</li>
</ol>
<ul>
<li>회원가입을 할 때 사용자 이름 등록하기</li>
<li><p>django-allauth 문서 홈페이지/Signals 탭에서 관련 명령어를 확인할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> allauth.account.signals <span class="keyword">import</span> user_signed_up</span><br><span class="line"><span class="keyword">from</span> allauth.socialaccount.models <span class="keyword">import</span> SocialAccount</span><br><span class="line"></span><br><span class="line"><span class="comment"># 시그널이 발생했을 때 실행될 함수</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">naver_signup</span><span class="params">(request, user, **kwargs)</span>:</span></span><br><span class="line">    social_user = SocialAccount.objects.filter(user=user)</span><br><span class="line">    <span class="keyword">if</span> social_user.exists():</span><br><span class="line">        user.last_name = social_user[<span class="number">0</span>].extra_data[<span class="string">'name'</span>]</span><br><span class="line">        user.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 시그널과 해당 함수를 connect</span></span><br><span class="line"><span class="comment"># 시그널 연결 방법 2가지 receiver 쓰는 방법, connect 쓰는 방법</span></span><br><span class="line">user_signed_up.connect(naver_signup)</span><br></pre></td></tr></table></figure>
</li>
<li><p>관리자 페이지에서 인증 및 권한/사용자(들)에서 계정을 삭제하고 다시 만들어보자.</p>
</li>
<li>이름이 등록되어 있는지 확인하자.</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/15/190515-Django-Study/" data-id="cjyco4kr5009t31wu0jjfef5i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190514-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/14/190514-Django-Study/" class="article-date">
  <time datetime="2019-05-14T10:38:43.000Z" itemprop="datePublished">2019-05-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/14/190514-Django-Study/">2019.05.14 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Board-project"><a href="#Board-project" class="headerlink" title="[ Board project ]"></a>[ Board project ]</h2><ul>
<li><p>get_object_or_404, get_list_or_404</p>
<ul>
<li>데이터가 하나도 없다면 에러 발생</li>
<li>views.py 수정<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 해당 모듈 추가</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404, redirect, get_list_or_404</span><br><span class="line"></span><br><span class="line"><span class="comment"># document_list의 documents 수정</span></span><br><span class="line"><span class="comment"># get_list_or_404 사용</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># documents = Document.objects.all()</span></span><br><span class="line">    documents = get_list_or_404(Document) <span class="comment"># objects.all()을 포함하는 코드</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_list.html'</span>,&#123;<span class="string">'object_list'</span>:documents&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># document_update의 documents 수정</span></span><br><span class="line"><span class="comment"># get_object_or_404 사용</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_update</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    <span class="comment"># 객체를 불러와서, 데이터를 수정</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="comment"># document = Document.objects.get(pk=document_id)</span></span><br><span class="line">        document = get_object_or_404(Document, pk=document_id)</span><br><span class="line"></span><br><span class="line">        form = DocumentForm(request.POST, request.FILES, instance=document)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            document = form.save()</span><br><span class="line">            <span class="keyword">return</span> redirect(document)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># document = Document.objects.get(pk=document_id)</span></span><br><span class="line">        document = get_object_or_404(Document, pk=document_id)</span><br><span class="line">        form = DocumentForm(instance=document)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_update.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># document_detail의 documents 수정</span></span><br><span class="line"><span class="comment"># get_object_or_404 수정</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_detail</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    <span class="comment"># document = Document.objects.get(pk=document_id)</span></span><br><span class="line">    document = get_object_or_404(Document, pk=document_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_detail.html'</span>, &#123;<span class="string">'object'</span>:document&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>paging 기능 추가</p>
<ul>
<li>기능 구현 포인트<ul>
<li>현재 페이지가 몇 페이지인지 생각한다.</li>
<li>페이지 당 개수를 몇으로 할 것인지 생각한다.</li>
</ul>
</li>
<li><p>views.py의 document_list(request) 수정</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 모듈 추가</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># QuerySet</span></span><br><span class="line">    <span class="comment"># 1. 객체를 선택</span></span><br><span class="line">    <span class="comment"># 2. 객체 생성</span></span><br><span class="line">    <span class="comment"># 3. 객체 필터링</span></span><br><span class="line">    <span class="comment"># 4. 객체 삭제</span></span><br><span class="line">    page = int(request.GET.get(<span class="string">'page'</span>, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 페이징 기능을 구현</span></span><br><span class="line">    <span class="comment"># 페이지 당 개수</span></span><br><span class="line">    paginated_by = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># QuerySet 객체 슬라이싱 할 때 [시작번호:끝번호]</span></span><br><span class="line">    <span class="comment"># 1 = 0 부터 ===== page*paginated_by</span></span><br><span class="line">    <span class="comment"># 2 = paginated_by*(page-1) ==== 6</span></span><br><span class="line">    <span class="comment"># 3 = paginated_by*(page-1) ==== 9</span></span><br><span class="line"></span><br><span class="line">    total_count = len(documents)</span><br><span class="line">    total_page = math.ceil(total_count/paginated_by)</span><br><span class="line">    page_range = range(<span class="number">1</span>, total_page+<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 전체 개수 = 전체 페이지 수</span></span><br><span class="line">    start_index = paginated_by * (page - <span class="number">1</span>)</span><br><span class="line">    end_index = paginated_by * page</span><br><span class="line"></span><br><span class="line">    documents = get_list_or_404(Document)</span><br><span class="line">    documents = documents[start_index:end_index]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_list.html'</span>,&#123;<span class="string">'object_list'</span>:documents,</span><br><span class="line">                                                    <span class="string">'total_page'</span>:total_page,</span><br><span class="line">                                                    <span class="string">'page_range'</span>:page_range&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>document_list.html 수정</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">    &#123;% block title %&#125;</span><br><span class="line">    Photo List</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">    &#123;% block content %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-12"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></span><br><span class="line">                &#123;% for object in object_list %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.author.username&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.updated&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--// Pagination 적용 //--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">nav</span> <span class="attr">aria-label</span>=<span class="string">"Page navigation example"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination justify-content-center"</span>&gt;</span></span><br><span class="line">                    &#123;% for page in page_range %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"page-item"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"page-link"</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:list' %&#125;?page=&#123;&#123;page&#125;&#125;"</span>&gt;</span>&#123;&#123;page&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    &#123;% endfor %&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>검색 기능 추가</p>
<ul>
<li>검색 기능을 구별하는 위치<ol>
<li>DB 질의문 - like 구문</li>
<li>코드 레벨 검색(python 구문)</li>
</ol>
</li>
<li>검색 기능을 구현 순서<ol>
<li>먼저 검색어를 제대로 받았는지 확인</li>
<li>filter 적용<ul>
<li>어떤 항목으로 할 것인가? - ex) 작성자, 제목, 내용</li>
<li>어떤 옵션으로 할 것인가? - ex) 내용 중에 단어를 시작, 중간, 끝에서 검색</li>
</ul>
</li>
</ol>
</li>
<li><p>views.py의 document_list(request) 수정</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># 모듈 추가</span></span><br><span class="line">   <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">document_list</span><span class="params">(request)</span>:</span></span><br><span class="line">       <span class="comment"># QuerySet</span></span><br><span class="line">       <span class="comment"># 1. 객체를 선택</span></span><br><span class="line">       <span class="comment"># 2. 객체 생성</span></span><br><span class="line">       <span class="comment"># 3. 객체 필터링</span></span><br><span class="line">       <span class="comment"># 4. 객체 삭제</span></span><br><span class="line">       page = int(request.GET.get(<span class="string">'page'</span>, <span class="number">1</span>))</span><br><span class="line">       paginated_by = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">       <span class="string">"""</span></span><br><span class="line"><span class="string">       username =&gt; Q(author__username__icontains=search_key)</span></span><br><span class="line"><span class="string">       title =&gt; Q(title__icontains=search_key)</span></span><br><span class="line"><span class="string">       text =&gt; Q(text__icontains=search_key)</span></span><br><span class="line"><span class="string">       q1|q2|q3</span></span><br><span class="line"><span class="string">       if search_key and search_type:</span></span><br><span class="line"><span class="string">           documents = get_list_or_404(Document, q1|q2|q3)</span></span><br><span class="line"><span class="string">       """</span></span><br><span class="line">       <span class="string">"""</span></span><br><span class="line"><span class="string">       필드명 = "값" 매칭</span></span><br><span class="line"><span class="string">       필드명__exact = "값" 매칭</span></span><br><span class="line"><span class="string">       필드명__iexact = "값" 대소문자 구분없이 매칭</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">       __startswith, __istartswitch 값으로 시작</span></span><br><span class="line"><span class="string">       __endswith, __iendswith 값으로 끝</span></span><br><span class="line"><span class="string">       __contains, __icontains 값을 포함하는지</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">       ForeignKey 매칭</span></span><br><span class="line"><span class="string">       필드명__해당모델의필드명 매칭</span></span><br><span class="line"><span class="string">       필드명__해당모델의 필드명__옵션 위와 동일하게 동작</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">       __gt=값, __gte=크다, 크거나 같다.</span></span><br><span class="line"><span class="string">       ex) created__gt = 오늘 =&gt; 작성일이 오늘보다 크다.</span></span><br><span class="line"><span class="string">       __lt=값, __lte=작다, 작거나 같다.</span></span><br><span class="line"><span class="string">       ex) created__lt = 오늘 =&gt; 작성일이 오늘보다 이전</span></span><br><span class="line"><span class="string">       ex) 판매시작일__lte = 오늘 =&gt; 판매시작일 설정값이 오늘보다 작거나 같으면 판매 시작</span></span><br><span class="line"><span class="string">       """</span></span><br><span class="line">       <span class="string">"""</span></span><br><span class="line"><span class="string">       objects.filter() : filter 메서드에 들어가는 매개변수들은 항상 and 연산을 한다.</span></span><br><span class="line"><span class="string">       or 연산을 하고 싶어서 Q 객체를 사용한다.</span></span><br><span class="line"><span class="string">       사용법은 filter에 들어가는 매개변수의 작성법과 똑같다.</span></span><br><span class="line"><span class="string">       </span></span><br><span class="line"><span class="string">       Q() | Q() = or</span></span><br><span class="line"><span class="string">       Q() &amp; Q() = and</span></span><br><span class="line"><span class="string">       ~Q() = not</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Q 객체를 쓰려면 맨뒤에 일반 필터를 써야한다.</span></span><br><span class="line"><span class="string">   	Q 객체 앞으로 일반필터를 사용하면 안된다.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ex) Document.objects.filter(third_q , default_q | second_q) </span></span><br><span class="line"><span class="string">           -&gt; third_q와 default_q | second_q의 and라는 의미</span></span><br><span class="line"><span class="string">       """</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># 검색 사용방법</span></span><br><span class="line">       <span class="comment"># documents = Document.objects.filter(title__icontains='검색어')</span></span><br><span class="line">       <span class="comment"># ex) documents = get_list_or_404(Document,title__icontains='검색어')</span></span><br><span class="line"></span><br><span class="line">       <span class="comment"># request.METHOD.get -&gt; 아이템 1개</span></span><br><span class="line">       <span class="comment"># request.METHOD.getlist -&gt; 리스트형태로</span></span><br><span class="line">       search_type = request.GET.getlist(<span class="string">'search_type'</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">       search_key = request.GET.get(<span class="string">'search_key'</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> search_key <span class="keyword">and</span> search_type:</span><br><span class="line">           q1 = Q(author__username__icontains=search_key) <span class="keyword">if</span> <span class="string">'author'</span> <span class="keyword">in</span> search_type <span class="keyword">else</span> Q()</span><br><span class="line">           q2 = Q(title__icontains=search_key) <span class="keyword">if</span> <span class="string">'title'</span> <span class="keyword">in</span> search_type <span class="keyword">else</span> Q()</span><br><span class="line">           q3 = Q(text__icontains=search_key) <span class="keyword">if</span> <span class="string">'text'</span> <span class="keyword">in</span> search_type <span class="keyword">else</span> Q()</span><br><span class="line"></span><br><span class="line">           documents = get_list_or_404(Document, q1|q2|q3)</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           documents = get_list_or_404(Document)</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 다른 방법</span></span><br><span class="line">       <span class="comment"># search_q = None</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="comment"># if search_key and search_type:</span></span><br><span class="line">       <span class="comment">#     if 'author' in search_type:</span></span><br><span class="line">       <span class="comment">#         temp_q = Q(author__username__icontains=search_key)</span></span><br><span class="line">       <span class="comment">#         search_q = search_q | temp_q if search_q else temp_q</span></span><br><span class="line">       <span class="comment">#     if 'title' in search_type:</span></span><br><span class="line">       <span class="comment">#         temp_q = Q(title__icontains=search_key)</span></span><br><span class="line">       <span class="comment">#         search_q = search_q|temp_q if search_q else temp_q</span></span><br><span class="line">       <span class="comment">#     if 'text' in search_type:</span></span><br><span class="line">       <span class="comment">#         temp_q = Q(text__icontains=search_key)</span></span><br><span class="line">       <span class="comment">#         search_q = search_q | temp_q if search_q else temp_q</span></span><br><span class="line">       <span class="comment">#</span></span><br><span class="line">       <span class="comment">#     documents = get_list_or_404(Document, search_q)</span></span><br><span class="line">       <span class="comment"># else:</span></span><br><span class="line">       <span class="comment">#     documents = get_list_or_404(Document)</span></span><br><span class="line"></span><br><span class="line">       total_count = len(documents)</span><br><span class="line">       total_page = math.ceil(total_count/paginated_by)</span><br><span class="line">       page_range = range(<span class="number">1</span>, total_page+<span class="number">1</span>)</span><br><span class="line">       start_index = paginated_by * (page - <span class="number">1</span>)</span><br><span class="line">       end_index = paginated_by * page</span><br><span class="line"></span><br><span class="line">       documents = documents[start_index:end_index]</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">return</span> render(request, <span class="string">'board/document_list.html'</span>,&#123;<span class="string">'object_list'</span>:documents,</span><br><span class="line">                                                       <span class="string">'total_page'</span>:total_page,</span><br><span class="line">                                                       <span class="string">'page_range'</span>:page_range&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>document_list.html 수정</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Photo List</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-12"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span></span><br><span class="line">            &#123;% for object in object_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.title&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.author.username&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;object.updated&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">aria-label</span>=<span class="string">"Page navigation example"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination justify-content-center"</span>&gt;</span></span><br><span class="line">                &#123;% for page in page_range %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"page-item"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"page-link"</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'board:list' %&#125;?page=&#123;&#123;page&#125;&#125;"</span>&gt;</span>&#123;&#123;page&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;% endfor %&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--// checkbox 적용 //--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">id</span>=<span class="string">"search_form"</span> <span class="attr">class</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">            &#123;%csrf_token%&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-row align-items-center justify-content-center"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"search_type"</span> <span class="attr">id</span>=<span class="string">"inlineCheckbox1"</span> <span class="attr">value</span>=<span class="string">"author"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span> <span class="attr">for</span>=<span class="string">"inlineCheckbox1"</span>&gt;</span>작성자<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"search_type"</span> <span class="attr">id</span>=<span class="string">"inlineCheckbox2"</span> <span class="attr">value</span>=<span class="string">"title"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span> <span class="attr">for</span>=<span class="string">"inlineCheckbox2"</span>&gt;</span>제목<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-check form-check-inline"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-check-input"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"search_type"</span> <span class="attr">id</span>=<span class="string">"inlineCheckbox3"</span> <span class="attr">value</span>=<span class="string">"text"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-check-label"</span> <span class="attr">for</span>=<span class="string">"inlineCheckbox3"</span>&gt;</span>본문<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--// search 기능 추가 //--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-row align-items-center justify-content-center"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-3 my-1"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span>, <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Search Keyword"</span> <span class="attr">name</span>=<span class="string">"search_key"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-auto my-1"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>python shell로 검색을 연습해보자.</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py shell</span><br></pre></td></tr></table></figure>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> board.models <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">Document.objects.filter(pk=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(pk=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(pk=<span class="number">2</span>, title=<span class="string">'Image Test 2'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(pk=<span class="number">2</span>, title=<span class="string">'Image Test 3'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__startswith=<span class="string">'Image'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__endswith=<span class="string">'12'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__iexact=<span class="string">'image'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__iexact=<span class="string">'ima'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__istartswith=<span class="string">'image'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__icontains=<span class="string">'ge'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(title__icontains=<span class="string">'es'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(category__name=<span class="string">'Cosmetic Question'</span>)</span><br><span class="line"></span><br><span class="line">Document.objects.filter(category__name__endswith=<span class="string">'Question'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"></span><br><span class="line">Q(title__icontains=<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line">default_q = Q(title__icontains=<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line">second_q = Q(text__icontains=<span class="string">'1'</span>)</span><br><span class="line"></span><br><span class="line">default_q | second_q</span><br><span class="line"></span><br><span class="line">Document.objects.filter(default_q | second_q)</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/14/190514-Django-Study/" data-id="cjyco4kr7009x31wunfmqq8p0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190513-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/13/190513-Django-Study/" class="article-date">
  <time datetime="2019-05-13T12:00:22.000Z" itemprop="datePublished">2019-05-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/13/190513-Django-Study/">2019.05.13 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2019-05-13-Django-Study"><a href="#2019-05-13-Django-Study" class="headerlink" title="2019.05.13 Django Study"></a>2019.05.13 Django Study</h1><h2 id="Board-project"><a href="#Board-project" class="headerlink" title="[ Board project ]"></a>[ Board project ]</h2><ul>
<li><p>url이 있는 형태로 S3 버킷 만들기(media 파일용)</p>
<ul>
<li>board.[도메인 주소]로 버킷 이름을 설정한다.</li>
<li>퍼블릭 ACL 관리 체크 항목을 모두 해제한다.</li>
<li>버킷이 생성되면 속성 탭에서 정적 웹 사이트 호스팅을 활성화한다.</li>
<li>AWS ROUTE53에서 레코드를 생성한다.</li>
<li><p>pycharm project의 settings.py에 다음과 같이 추가한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line">DEFAULT_FILE_STORAGE = <span class="string">'config.asset_storage.MediaStorage'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>config/asset_storage.py를 생성하고 작성한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> storages.backends.s3boto3 <span class="keyword">import</span> S3Boto3Storage</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MediaStorage</span><span class="params">(S3Boto3Storage)</span>:</span></span><br><span class="line">    location = <span class="string">''</span></span><br><span class="line">    <span class="comment"># 오버라이드하는 방법을 항상 찾아보고 별도로 추가해보자.</span></span><br><span class="line">    bucket_name = <span class="string">'images.jinukk.me'</span></span><br><span class="line">    custom_domain = <span class="string">'images.jinukk.me'</span></span><br><span class="line">    file_overwrite = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>‘board’ 앱을 만들고 모델 설계하기</p>
<ul>
<li><p>‘board’라는 이름의 앱을 생성한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py startapp board</span><br></pre></td></tr></table></figure>
</li>
<li><p>settings.py에 앱을 등록한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'storages'</span>,</span><br><span class="line">    <span class="comment"># board 앱 등록</span></span><br><span class="line">    <span class="string">'board'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>models.py를 작성한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Category - slug, name</span></span><br><span class="line"><span class="string">Document - author, category, title, slug, text, image, created, updated</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># User 모델을 커스텀한 경우 불러다가 써야하기 때문에 사용</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> get_user_model</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="comment"># class Board(models.Model):</span></span><br><span class="line">    <span class="comment"># Board 모델을 만들어서 Category나 Document에 참조하여 사용하는 방법도 있다.</span></span><br><span class="line"><span class="comment">#    pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Category</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="comment"># CharField vs TextField의 차이 = 글자 수 제한</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    <span class="comment"># DB에는 index라는 키 값이 걸려있다.</span></span><br><span class="line">    <span class="comment"># 대량의 데이터를 입력, 수정, 삭제, 검색 등을 잘 수행하기 위해 설계한 것이 DB</span></span><br><span class="line">    <span class="comment"># -&gt; file 형태 대신 DB를 쓰는 이유</span></span><br><span class="line">    <span class="comment"># 미리 검색과 정렬에 적합하도록 설계하는 것이 index</span></span><br><span class="line">    <span class="comment"># allow_unicode = 한글 처리 가능</span></span><br><span class="line">    slug = models.SlugField(max_length=<span class="number">30</span>, db_index=<span class="literal">True</span>, unique=<span class="literal">True</span>, allow_unicode=<span class="literal">True</span>)</span><br><span class="line">    description = models.CharField(max_length=<span class="number">200</span>, blank=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 검색 엔진에게 제공해주는 것이 meta_description</span></span><br><span class="line">    meta_description = models.CharField(max_length=<span class="number">200</span>, blank=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        <span class="comment"># DB에 기본적으로 설정될 정렬값</span></span><br><span class="line">        ordering = [<span class="string">'slug'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Document</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=<span class="literal">True</span>, blank=<span class="literal">True</span>, related_name=<span class="string">'documents'</span>)</span><br><span class="line">    author = models.ForeignKey(get_user_model(), on_delete=models.CASCADE, related_name=<span class="string">'documents'</span>)</span><br><span class="line">    title = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    slug = models.SlugField(max_length=<span class="number">120</span>, db_index=<span class="literal">True</span>, unique=<span class="literal">True</span>, allow_unicode=<span class="literal">True</span>)</span><br><span class="line">    text = models.TextField()</span><br><span class="line">    <span class="comment"># upload_to 동적으로 경로 설정 가능</span></span><br><span class="line">    image = models.ImageField(upload_to=<span class="string">'board_images/%Y/%m/%d'</span>)</span><br><span class="line">    created = models.DateTimeField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    updated = models.DateTimeField(auto_now=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.title</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_absolute_url</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> reverse(<span class="string">'board:detail'</span>, args=[self.id])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 작성이 끝나면 makemigrantions와 migrate를 한다.</span></span><br><span class="line"><span class="comment"># AWS DB에 저장되지 않는다면 ip가 변경된 것일 수도 있다.</span></span><br><span class="line"><span class="comment"># AWS RDS에서 해당 데이터베이스의 인바운드를 확인한다.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>views.py를 작성한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404, redirect</span><br><span class="line"></span><br><span class="line"><span class="comment"># QuerySet은 모델의 디폴트 매니저를 통해 실행한다.</span></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Document</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># QuerySet</span></span><br><span class="line">    <span class="comment"># 1. 객체를 선택</span></span><br><span class="line">    <span class="comment"># 2. 객체 생성</span></span><br><span class="line">    <span class="comment"># 3. 객체 필터링</span></span><br><span class="line">    <span class="comment"># 4. 객체 삭제</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Models.objects -&gt; 매니저 -&gt; 도와주는 객체</span></span><br><span class="line">    <span class="comment"># 1. 모델의 전체 데이터 불러오기</span></span><br><span class="line">    documents = Document.objects.all()</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_list.html'</span>,&#123;<span class="string">'object_list'</span>:documents&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .forms <span class="keyword">import</span> DocumentForm</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_create</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="comment"># Document.objects.create() - 실행과 동시에 DB에 삽입을 한다.</span></span><br><span class="line">    <span class="comment"># 분기 - post, get</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="comment"># 처리</span></span><br><span class="line">        <span class="comment"># request.POST : 폼에서 입력한 텍스트 데이터가 넘어온다.</span></span><br><span class="line">        <span class="comment"># request.FILES : 파일</span></span><br><span class="line">        form = DocumentForm(request.POST, request.FILES)</span><br><span class="line">        form.instance.author_id = request.user.id</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            document = form.save()</span><br><span class="line">            <span class="keyword">return</span> redirect(document)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 입력 창</span></span><br><span class="line">        form = DocumentForm()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_create.html'</span>, &#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_update</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    <span class="comment"># 객체를 불러와서, 데이터를 수정</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        document = Document.objects.get(pk=document_id)</span><br><span class="line">        <span class="comment"># 모델폼을 사용할 때 instance를 넘겨주면, 해당 인스턴스 값으로 초기화가 되고</span></span><br><span class="line">        <span class="comment"># 만약 pk가 있는 instance라면 update를 수행한다.</span></span><br><span class="line">        <span class="comment"># request.POST와 instance가 같이 전달되면, POST 데이터가 우선순위가 높다.</span></span><br><span class="line">        form = DocumentForm(request.POST, request.FILES, instance=document)</span><br><span class="line">        <span class="comment"># instance가 매개변수로 있어야 create가 아닌 update로 인식한다.</span></span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            document = form.save()</span><br><span class="line">            <span class="keyword">return</span> redirect(document)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        document = Document.objects.get(pk=document_id)</span><br><span class="line">        <span class="comment"># modelform init with instance(model object)</span></span><br><span class="line">        form = DocumentForm(instance=document) <span class="comment"># instance 매개변수 사용</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_update.html'</span>,&#123;<span class="string">'form'</span>:form&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_detail</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    document = Document.objects.get(pk=document_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_detail.html'</span>, &#123;<span class="string">'object'</span>:document&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">document_delete</span><span class="params">(request, document_id)</span>:</span></span><br><span class="line">    <span class="comment"># 객체를 불러와서 delete만 호출</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'board/document_delete.html'</span>,&#123;<span class="string">'object'</span>:document&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>admin.py를 작성한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Category,Document</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CategoryOption</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'slug'</span>]</span><br><span class="line">    prepopulated_fields = &#123;<span class="string">'slug'</span>:(<span class="string">'name'</span>,)&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DocumentOption</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'id'</span>, <span class="string">'author'</span>, <span class="string">'title'</span>, <span class="string">'slug'</span>, <span class="string">'created'</span>, <span class="string">'updated'</span>]</span><br><span class="line">    prepopulated_fields = &#123;<span class="string">'slug'</span>:(<span class="string">'title'</span>,)&#125;</span><br><span class="line"></span><br><span class="line">admin.site.register(Category, CategoryOption)</span><br><span class="line">admin.site.register(Document, DocumentOption)</span><br></pre></td></tr></table></figure>
</li>
<li><p>config/urls.py를 작성한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'site_config/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">''</span>, include(<span class="string">'board.urls'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>board/urls.py를 생성하고 작성한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.views <span class="keyword">import</span> LoginView, LogoutView</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .views <span class="keyword">import</span> document_list, document_create, document_update, document_delete, document_detail</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">'board'</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'delete/&lt;int:document_id&gt;'</span>, document_delete, name=<span class="string">'delete'</span>),</span><br><span class="line">    path(<span class="string">'update/&lt;int:document_id&gt;'</span>, document_update, name=<span class="string">'update'</span>),</span><br><span class="line">    path(<span class="string">'create/'</span>, document_create, name=<span class="string">'create'</span>),</span><br><span class="line">    path(<span class="string">'detail/&lt;int:document_id&gt;/'</span>,document_detail, name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">''</span>, document_list, name=<span class="string">'list'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>templates 파일을 생성하여 작성한다.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--//</span></span><br><span class="line"><span class="comment">board_project/layout/base.html</span></span><br><span class="line"><span class="comment">settings.py의 TEPLATES에서 DIRS를 수정하는 것을 잊지 말자. </span></span><br><span class="line"><span class="comment">//--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;% block title %&#125;&#123;% endblock %&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"</span> <span class="attr">integrity</span>=<span class="string">"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-3.3.1.slim.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"</span> <span class="attr">integrity</span>=<span class="string">"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"</span> <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--//</span></span><br><span class="line"><span class="comment">board/templates/board/document_list.html </span></span><br><span class="line"><span class="comment">//--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Photo List</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">    &#123;% for object in object_list %&#125;</span><br><span class="line">        &#123;&#123;object.title&#125;&#125; &#123;&#123;object.text&#125;&#125; &#123;&#123;object.image.url&#125;&#125; &#123;&#123;object.author.username&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--//</span></span><br><span class="line"><span class="comment">board/templates/board/document_detail.html</span></span><br><span class="line"><span class="comment">//--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Photo Detail</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">        &#123;&#123;object.title&#125;&#125; &#123;&#123;object.text&#125;&#125; &#123;&#123;object.image.url&#125;&#125; &#123;&#123;object.author.username&#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--//</span></span><br><span class="line"><span class="comment">board/templates/board/document_create.html </span></span><br><span class="line"><span class="comment">//--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Board Create</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--// 파일을 보내는 경우 enctype를 추가해야 한다. //--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.as_table&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Write"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--//</span></span><br><span class="line"><span class="comment">board/templates/board/document_update.html</span></span><br><span class="line"><span class="comment">//--&gt;</span></span><br><span class="line">&#123;% extends 'base.html' %&#125;</span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">Photo Update</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-6"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">            &#123;% csrf_token %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            &#123;&#123;form.as_table&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Update"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>서버를 실행하여 이미지 파일을 올려보고 S3에 업로드되는지 확인하자.</p>
</li>
</ul>
</li>
</ul>
<h2 id="jQuery-Practice"><a href="#jQuery-Practice" class="headerlink" title="jQuery Practice"></a>jQuery Practice</h2><ul>
<li>html 파일을 생성한다.</li>
<li>jQuery.com - Download - google CDN - jQuery/3.x snippet의 내용을 html 파일에 작성한다.<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    내용</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>내용 토글<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"btn_menu"</span>&gt;</span>MENU<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"main_menu"</span> <span class="attr">style</span>=<span class="string">"display:none;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>메뉴1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>메뉴2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>메뉴3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>메뉴4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">"contents"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn_change"</span>&gt;</span>내용바꾸기<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"register_form"</span>&gt;</span></span><br><span class="line">    username : <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    주소 : <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"address"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"회원가입"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--//</span></span><br><span class="line"><span class="comment">    jQuery : 액션에 대해서 리액션</span></span><br><span class="line"><span class="comment">    액션 : 마우스 클릭, 롤오버, 롤아웃, 키 프레스, 키 다운, 키 업, 스크롤</span></span><br><span class="line"><span class="comment">    리액션 : 어떤 요소를 보여준다. 감춘다. 변경한다.</span></span><br><span class="line"><span class="comment">    어떤 버튼을 클릭하면 - 메뉴가 나타난다.</span></span><br><span class="line"><span class="comment">    어떤 키를 누르면 - 페이지를 이동한다.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    들여쓰기를 따로 하지 않아도 동작에는 문제가 없다.</span></span><br><span class="line"><span class="comment">//--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    // 기본 코드 : 읽자마자 실행</span></span><br><span class="line"><span class="undefined">    $(function() &#123;</span></span><br><span class="line"><span class="undefined">        // 초기화 코드</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    $(document).ready(function() &#123;</span></span><br><span class="line"><span class="undefined">        // 문서 로드가 끝난 후에 실행</span></span><br><span class="line"><span class="undefined">        // 어떤 액션에 대해서 무슨 리액션을 할 것인지 연결 목록</span></span><br><span class="line"><span class="undefined">        // 액션 : a태그 클릭 - 어떤 요소 + 어떤 이벤트</span></span><br><span class="line"><span class="undefined">        // 리액션 : div태그 보이기/숨기기 - 어떤 함수</span></span><br><span class="line"><span class="undefined">        $('a').click(function() &#123;</span></span><br><span class="line"><span class="undefined">            $('div').toggle();</span></span><br><span class="line"><span class="undefined">            // $('div').hide(); - 사라지게 하고 싶다면</span></span><br><span class="line"><span class="undefined">            // $('div').show(); - 보이게 하고 싶다면</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        $('.btn_menu').click(function() &#123;</span></span><br><span class="line"><span class="undefined">            //$('.main_menu').toggle();</span></span><br><span class="line"><span class="undefined">            if ($('.main_menu').is(":visible")) &#123;</span></span><br><span class="line"><span class="undefined">                $('.main_menu').hide(1000);</span></span><br><span class="line"><span class="undefined">            &#125; else &#123;</span></span><br><span class="line"><span class="undefined">                $('.main_menu').show(1000);</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        $('.btn_change').click(function() &#123;</span></span><br><span class="line"><span class="undefined">        // 요소.html() - 요소 안에 있는 html 코드 불러오기</span></span><br><span class="line"><span class="undefined">        // 요소.html(내용) - 요소 안에 있는 html 코드를 내용으로 교체한다.</span></span><br><span class="line"><span class="undefined">            $('.contents').html("내용채우기 실습!");</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        $('#register_form').submit(function() &#123;</span></span><br><span class="line"><span class="undefined">            // 위에서 validation을 하고</span></span><br><span class="line"><span class="undefined">            // val() - 비어있으면 값 읽기</span></span><br><span class="line"><span class="undefined">            // val(값) - 값이 있으면 값 할당</span></span><br><span class="line"><span class="undefined">            username = $('input[name="username"]').val();</span></span><br><span class="line"><span class="undefined">            $('input[name="address"]').val(username+"@nate.com");</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">            // validation이 실패했다면 return false; 성공했다면 return true;</span></span><br><span class="line"><span class="undefined">            return false;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">    /*</span></span><br><span class="line"><span class="undefined">        - 기명함수</span></span><br><span class="line"><span class="undefined">        function [함수이름]([매개변수])&#123;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        - 무기명함수, 일회용</span></span><br><span class="line"><span class="undefined">        function([매개변수])&#123;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        - 셀렉터 만드는 법</span></span><br><span class="line"><span class="undefined">        tag : tag이름</span></span><br><span class="line"><span class="undefined">        class : .class이름</span></span><br><span class="line"><span class="undefined">        id : #id</span></span><br><span class="line"><span class="undefined">    */</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/13/190513-Django-Study/" data-id="cjyco4kr4009r31wunwt0e6nj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190510-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/10/190510-Django-Study/" class="article-date">
  <time datetime="2019-05-10T12:00:09.000Z" itemprop="datePublished">2019-05-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/10/190510-Django-Study/">2019.05.10 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2019-05-10-Django-Study"><a href="#2019-05-10-Django-Study" class="headerlink" title="2019.05.10 Django Study"></a>2019.05.10 Django Study</h1><h2 id="Dstargram-project"><a href="#Dstargram-project" class="headerlink" title="[ Dstargram project ]"></a>[ Dstargram project ]</h2><h4 id="aws-S3를-이용하여-이미지-파일을-저장하고"><a href="#aws-S3를-이용하여-이미지-파일을-저장하고" class="headerlink" title="aws S3를 이용하여 이미지 파일을 저장하고"></a>aws S3를 이용하여 이미지 파일을 저장하고</h4><h4 id="해당-글을-삭제했으나-S3에는-이미지가-삭제되지-않음"><a href="#해당-글을-삭제했으나-S3에는-이미지가-삭제되지-않음" class="headerlink" title="해당 글을 삭제했으나, S3에는 이미지가 삭제되지 않음"></a>해당 글을 삭제했으나, S3에는 이미지가 삭제되지 않음</h4><h4 id="signal을-사용하여-S3에도-이미지가-삭제되도록-변경"><a href="#signal을-사용하여-S3에도-이미지가-삭제되도록-변경" class="headerlink" title="signal을 사용하여 S3에도 이미지가 삭제되도록 변경"></a>signal을 사용하여 S3에도 이미지가 삭제되도록 변경</h4><ul>
<li>signal<ul>
<li>~하기 전에, ~한 후에 발생하는 일들을 말함</li>
<li>후속 조치를 하는 것</li>
<li>대표적인 signal 종류<ul>
<li>pre_save : 저장하기 전</li>
<li>post_save : 저장한 후</li>
<li>pre_delete : 지우기 전</li>
<li>post_delete : 지운 후</li>
</ul>
</li>
</ul>
<ol>
<li>어떤 시그널이 발생했을 때 반응할 것인지 생각해야 한다.</li>
<li>그 시그널이 발생한 것을 어떻게 알았는지 생각해야 한다.</li>
</ol>
<ul>
<li>views.py에 추가<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models.signals <span class="keyword">import</span> post_delete</span><br><span class="line"><span class="keyword">from</span> django.dispatch <span class="keyword">import</span> receiver</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> boto3</span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="comment"># @receiver(어떤 시그널이 발생했는가?, 누가 발생시켰는가?)</span></span><br><span class="line"><span class="comment"># sender가 없다면 모든 경우에 post_delete가 발생</span></span><br><span class="line"><span class="comment"># sender=Photo를 해줌으로써 Photo가 있는 경우에만 발생</span></span><br><span class="line"><span class="meta">@receiver(post_delete, sender=Photo)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post_delete</span><span class="params">(sender, instance, **kwargs)</span>:</span></span><br><span class="line">    session = boto3.Session(</span><br><span class="line">        aws_access_key_id=settings.AWS_ACCESS_KEY_ID,</span><br><span class="line">        aws_secret_access_key=settings.AWS_SECRET_ACCESS_KEY,</span><br><span class="line">        region_name=settings.AWS_REGION</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># s3.Objects는 s3에 업로드된 파일 객체를 얻어오는 클래스</span></span><br><span class="line">    <span class="comment"># arg1 = 버킷네임</span></span><br><span class="line">    <span class="comment"># arg2 = 파일 경로 - Key</span></span><br><span class="line">    s3 = session.resource(<span class="string">'s3'</span>) <span class="comment"># s3 권한 가져오기</span></span><br><span class="line">    image = s3.Object(settings.AWS_STORAGE_BUCKET_NAME, <span class="string">"media/"</span>+str(instance.image))</span><br><span class="line">    image.delete()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="Board-project"><a href="#Board-project" class="headerlink" title="[ Board project ]"></a>[ Board project ]</h2><ul>
<li>DB는 AWS RDS - postgreSQL로 만들기(Postgre 10.x ver.)</li>
<li><p>url이 있는 형태로 S3 버킷 만들기(static 파일용)</p>
<ol>
<li><p>장고 프로젝트 생성</p>
<ul>
<li><p>pycharm에서 board_project를 생성 후, 진행</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ pip install django</span><br><span class="line"></span><br><span class="line">django-admin startproject config .</span><br></pre></td></tr></table></figure>
</li>
<li><p>관련 모듈을 미리 설치하자.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ pip install psycopg2-binary</span><br><span class="line"></span><br><span class="line">$ pip install boto3</span><br><span class="line"></span><br><span class="line">$ pip install django-storages</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>AWS RDS에 DB 만들기(Postgre 10.7 사용)</p>
<ul>
<li>파라미터 그룹은 Postgre 10으로 새로 생성하여 사용한다.</li>
<li>DB 세부 정보를 지정할 때만 DB 엔진 버전을 PostgreSQL 10.7을 선택한다.</li>
<li>나머지는 dstagram_project와 동일하게 진행했다.</li>
<li><p>pycharm project의 settings.py를 수정한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/settings.py</span></span><br><span class="line"><span class="comment"># 기존 데이터베이스 항목을 수정</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="comment"># psycopg2 - binary 이용</span></span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.postgresql_psycopg2'</span>,</span><br><span class="line">        <span class="comment"># Amazon 해당 DB의 구성 - DB 이름</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'board'</span>,</span><br><span class="line">        <span class="comment"># Amazon database 생성 때 작성한 마스터 사용자 이름</span></span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'amazon master user name'</span>,</span><br><span class="line">        <span class="comment"># Amazon database 생성 때 작성한 마스터 암호</span></span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'amazon master password'</span>,</span><br><span class="line">        <span class="comment"># Amazon 해당 DB의 연결&amp;보안 - 엔드포인트</span></span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'wps10-board.cnuxbldx8kex.ap-northeast-2.rds.amazonaws.com'</span>,</span><br><span class="line">        <span class="comment">#  # Amazon database 생성 때 포트</span></span><br><span class="line">        <span class="string">'POST'</span>: <span class="string">'5432'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>DB를 초기화하고 관리자 계정을 생성하여 확인한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py migrate</span><br><span class="line"></span><br><span class="line">$ python manage.py createsuperuser</span><br><span class="line"></span><br><span class="line">$ python manage.py runserver</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>AWS S3에 static 파일용 버킷 만들기</p>
<ul>
<li>board.[도메인 주소]로 버킷 이름을 설정한다.</li>
<li>퍼블릭 ACL 관리 체크 항목을 모두 해제한다.</li>
<li>버킷이 생성되면 속성 탭에서 정적 웹 사이트 호스팅을 활성화한다.</li>
<li>AWS ROUTE53에서 레코드를 생성한다.</li>
<li><p>pycharm project의 settings.py를 수정한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AWS_ACCESS_KEY_ID = <span class="string">'Amazon User Access Key ID 값'</span> <span class="comment"># 반드시 지우고 github에 올려야한다.</span></span><br><span class="line">AWS_SECRET_ACCESS_KEY = <span class="string">'Amazon User Secret Key 값'</span> <span class="comment"># # 반드시 지우고 github에 올려야한다.</span></span><br><span class="line">AWS_REGION = <span class="string">'ap-northeast-2'</span></span><br><span class="line">AWS_STORAGE_BUCKET_NAME = <span class="string">'board.jinukk.me'</span></span><br><span class="line">AWS_S3_CUSTOM_DOMAIN = <span class="string">'%s'</span> % AWS_STORAGE_BUCKET_NAME</span><br><span class="line">AWS_S3_SECURE_URLS = <span class="literal">False</span> <span class="comment"># https -&gt; http</span></span><br><span class="line">AWS_S3_OBJECT_PARAMETERS = &#123;</span><br><span class="line"><span class="string">'CacheControl'</span>: <span class="string">'max-age=86400'</span>,</span><br><span class="line">&#125;</span><br><span class="line">AWS_DEFAULT_ACL = <span class="string">'public-read'</span></span><br><span class="line">AWS_LOCATION = <span class="string">'static'</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">'https://%s/%s/'</span> % (AWS_S3_CUSTOM_DOMAIN, AWS_LOCATION)</span><br><span class="line">STATICFILES_STORAGE = <span class="string">'storages.backends.s3boto3.S3Boto3Storage'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>다음 명렁어를 통해 Amazon S3에 static 관련 파일을 옮긴다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py collectstatic</span><br><span class="line"><span class="comment"># 명령어 입력 후, yes를 한번 더 입력한다.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Amazon S3의 해당 버킷에 static 파일이 옮겨졌는지 확인하자.</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/10/190510-Django-Study/" data-id="cjyco4kr3009o31wuvkt6mvnd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190509-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/09/190509-Django-Study/" class="article-date">
  <time datetime="2019-05-09T11:53:26.000Z" itemprop="datePublished">2019-05-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/09/190509-Django-Study/">2019.05.09 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2019-05-09-Django-Study"><a href="#2019-05-09-Django-Study" class="headerlink" title="2019.05.09 Django Study"></a>2019.05.09 Django Study</h1><h2 id="Amazon-S3-사용하기"><a href="#Amazon-S3-사용하기" class="headerlink" title="Amazon S3 사용하기"></a>Amazon S3 사용하기</h2><ul>
<li>도메인을 이용한 버킷 사용하기</li>
<li><p>media 파일 적용하기</p>
<ol>
<li>도메인을 구입한다.</li>
<li>Amazon - S3에서 버킷을 생성한다.<ul>
<li>버킷 이름은 media.[도메인 주소]로 한다.</li>
<li>권한 설정에서 다음과 같이 설정한다.<ul>
<li>퍼블릭 ACL 관리 체크 항목을 모두 해제한다.</li>
<li>퍼블릭 버킷 정책 관리 체크 항목을 모두 해제한다.</li>
<li>시스템 권한 관리에서 ‘엑세스 권한 부여함’을 선택한다.</li>
</ul>
</li>
<li>버킷이 생성되면 속성 탭에서 정적 웹 사이트 호스팅을 활성화한다.<ul>
<li>index.html, error.html은 그대로 입력하고 진행한다.</li>
</ul>
</li>
</ul>
</li>
<li>Amazon - Route53에서 설정한다.<ul>
<li>호스팅 영역 생성을 누르고 구입한 도메인 이름을 입력한다.</li>
<li>생성을 누른 후, NS 유형의 값을 확인한다.</li>
<li>도메인을 구입한 페이지로 이동하여 도메인 관리로 이동한다.</li>
<li>네임서버에 NS 유형의 값으로 수정한다.<ul>
<li>whois.kisa.or.kr의 WHOIS 조회를 통해 네임서버가 바뀌었는지 확인한다.</li>
</ul>
</li>
<li>다시 Amazon - Route53에서 레코드 편집 생성을 누른다.<ul>
<li>이름에는 media를 입력한다.</li>
<li>별칭을 ‘예’로 선택한다음 media.[도메인 주소] (s3-website)를 선택하고 생성한다.</li>
</ul>
</li>
</ul>
</li>
<li><p>해당 pycharm project에서 settings.py를 수정한다.</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">AWS_STORAGE_BUCKET_NAME = <span class="string">'도메인 주소으로 만든 버킷 이름'</span></span><br><span class="line">AWS_S3_CUSTOM_DOMAIN = <span class="string">'%s'</span> % AWS_STORAGE_BUCKET_NAME</span><br><span class="line">AWS_S3_SECURE_URLS = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># https에서 http로 수정</span></span><br><span class="line"><span class="comment"># http를 사용함</span></span><br><span class="line">STATIC_URL = <span class="string">'http://%s/%s/'</span> % (AWS_S3_CUSTOM_DOMAIN, AWS_LOCATION)</span><br><span class="line">STATICFILES_STORAGE = <span class="string">'storages.backends.s3boto3.S3Boto3Storage'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># media 관련</span></span><br><span class="line">DEFAULT_FILE_STORAGE = <span class="string">'config.asset_storage.MediaStorage'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>config/asset_storage.py를 생성하고 작성한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/asset_storage/py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> storages.backends.s3boto3 <span class="keyword">import</span> S3Boto3Storage</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MediaStorage</span><span class="params">(S3Boto3Storage)</span>:</span></span><br><span class="line">location = <span class="string">'media'</span></span><br><span class="line">file_overwrite = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>config/urls.py를 수정한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 주석 처리</span></span><br><span class="line"><span class="comment"># urlpatterns += static(settings.MEDIA_URL, document_root = settings.MEDIA_ROOT)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>서버를 실행한 후, 이미지 파일을 업로드해본다.</p>
</li>
<li>이미지 출력이 잘 되는지 확인하자.</li>
<li>Amazon - S3의 해당 버킷에 파일이 저장되어있는지 확인하자.</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="Amazon-RDS-사용하기"><a href="#Amazon-RDS-사용하기" class="headerlink" title="Amazon - RDS 사용하기"></a>Amazon - RDS 사용하기</h2><ul>
<li><p>Amazon Database 사용하기</p>
<ol>
<li><p>Amazon - RDS에서 데이터베이스를 생성한다.</p>
<ul>
<li>오른쪽 항목의 파라미터 그룹으로 이동하여 파라미터 그룹을 생성한다.</li>
<li>그룹 세부 정보에서 파라미터 그룹 패밀리는 postgres9.6을 선택하고 생성한다.</li>
<li><p>파라미터 그룹에서는 편집을 통해 파라미터를 수정할 수 있다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ex) encoding을 검색하고 편집을 누르면 해당 값인 UTF-8을 변경할 수있다.</span><br></pre></td></tr></table></figure>
</li>
<li><p>데이터베이스 생성을 누른다.</p>
<ol>
<li>엔진 선택<ul>
<li>PostgreSQL 선택</li>
<li>RDS 프리 티어에 적용되는 옵션만 적용</li>
</ul>
</li>
<li>DB 세부 정보 지정<ul>
<li>DB 엔진 버전을 PostgreSQL 9.6.12-R1을 선택</li>
<li>DB 인스턴스 식별자를 작성</li>
<li>마스터 사용자 이름을 작성</li>
<li>마스터 암호를 작성</li>
</ul>
</li>
<li>고급 설정 구성<ul>
<li>네트워크 및 보안에서 퍼블릭 엑세스 가능성을 ‘예’로 체크</li>
<li>데이터베이스 옵션에서 DB 파라미터 그룹을 생성한 파라미터 그룹으로 선택</li>
<li>백업은 0일로 설정</li>
<li>삭제 방지 활성화</li>
</ul>
</li>
<li>생성</li>
</ol>
</li>
</ul>
</li>
<li>데이터베이스 목록에서 해당 데이터베이스가 ‘사용 가능’이 될 때까지 기다린다.<ul>
<li>해당 데이터베이스를 클릭한다.</li>
<li>보안 - VPC 보안 그룹 - 하단 인바운드에서 IP를 추가할 수 있다.</li>
<li>연결&amp;보안 - 엔드포인트와 구성 - DB 이름을 알아둔다.</li>
</ul>
</li>
<li><p>pycharm project의 settings.py를 수정한다.</p>
<ul>
<li>settings.py를 수정한다.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/settings.py</span></span><br><span class="line"><span class="comment"># 기존 데이터베이스 항목을 수정</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="comment"># psycopg2 - binary 이용</span></span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.postgresql_psycopg2'</span>,</span><br><span class="line">        <span class="comment"># Amazon 해당 DB의 구성 - DB 이름</span></span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'dstagram'</span>,</span><br><span class="line">        <span class="comment"># Amazon database 생성 때 작성한 마스터 사용자 이름</span></span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'amazon master user name'</span>,</span><br><span class="line">        <span class="comment"># Amazon database 생성 때 작성한 마스터 암호</span></span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'amazon master password'</span>,</span><br><span class="line">        <span class="comment"># Amazon 해당 DB의 연결&amp;보안 - 엔드포인트</span></span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'wps10-dstagram.cnuxbldx8kex.ap-northeast-2.rds.amazonaws.com'</span>,</span><br><span class="line">        <span class="comment">#  # Amazon database 생성 때 포트</span></span><br><span class="line">        <span class="string">'POST'</span>: <span class="string">'5432'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>pycharm project의 DB를 초기화한다.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py migrate</span><br></pre></td></tr></table></figure>
</li>
<li><p>관리자 계정을 생성하고 서버를 실행하여 확인한다.</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py createsuperuser</span><br><span class="line"></span><br><span class="line">$ python manage.py runserver</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/09/190509-Django-Study/" data-id="cjyco4kqz009i31wu2wcgpqxl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-190508-Django-Study" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/08/190508-Django-Study/" class="article-date">
  <time datetime="2019-05-08T10:38:31.000Z" itemprop="datePublished">2019-05-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Study-Review/">Study Review</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/08/190508-Django-Study/">2019.05.08 Django Study</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="2019-05-08-Django-Study"><a href="#2019-05-08-Django-Study" class="headerlink" title="2019.05.08 Django Study"></a>2019.05.08 Django Study</h1><h2 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h2><ul>
<li><p>LAN과 WAN</p>
<ul>
<li>LAN = Local</li>
<li>WAN = Wide</li>
<li>LAN이 여러개 묶여서 WAN이 된다.</li>
<li>WAN이 여러개 묶여서 더 큰 WAN이 된다.</li>
<li>인터넷도 WAN에 한 일종</li>
</ul>
</li>
<li><p>일반적으로 Server는 데이터를 내어주는 쪽이고 client는 데이터를 받는 쪽이다.</p>
</li>
<li><p>DNS</p>
<ul>
<li><p>Domain Name Service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IP &lt;--DNS--&gt; Domain</span><br></pre></td></tr></table></figure>
</li>
<li><p>DNS는 하나만 두지 않는다.</p>
</li>
<li>서버의 이상 발생으로 인해 여러개를 둔다.(1, 2, 3, 4차 등등)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">네이버에 접속하는 과정</span><br><span class="line">1. naver.com 주소를 입력하게 되면</span><br><span class="line">2. hosts 파일을 검색하게 되고</span><br><span class="line">3. DNS 검색을 한 뒤,</span><br><span class="line">4. naver.com에 접속하게 된다.</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>도메인 구성</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ex) https://search.naver.com/search.naver?sm=top_hty&amp;fbm=1&amp;ie=utf8&amp;query=%EC%98%81%ED%99%94</span><br><span class="line"></span><br><span class="line">https - 스키마, 프로토콜</span><br><span class="line">search.naver.com - 도메인</span><br><span class="line">/search.naver - Path</span><br><span class="line">?sm=top_hty&amp;fbm=1&amp;ie=utf8&amp;query=%EC%98%81%ED%99%94 - Query String</span><br></pre></td></tr></table></figure>
</li>
<li><p>http와 https</p>
<ul>
<li>http<ul>
<li>Hypertext(문서끼리 링크로 연결되어 있는 것) Transfer Protocol</li>
</ul>
</li>
<li>https<ul>
<li>공개키 암호화<ul>
<li>공개키 = 암호화</li>
<li>개인키 = 복호화</li>
<li>웹 브라우저가 공개키를 받아서 암호화를 한다.</li>
</ul>
</li>
<li>회원가입, 결제 등 정보 입력은 모두 https</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="server와-client"><a href="#server와-client" class="headerlink" title="server와 client"></a>server와 client</h2><ul>
<li><p>데이터 처리 과정</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CDN --- LB --- EC2 --- DB</span><br><span class="line">                   |</span><br><span class="line">                   --- S3</span><br></pre></td></tr></table></figure>
<ul>
<li>CDN<ul>
<li>사용자와 가까운 위치에서 요청에 응답</li>
<li>cache 개념</li>
</ul>
</li>
<li>LB(Load Balancer)<ul>
<li>여러대의 서버가 적절히 분산 처리할 수 있도록 해결해주는 서비스</li>
<li>분산 처리하기 이전에 인증서(https)를 설치</li>
<li>EC2와는 http로 통신</li>
</ul>
</li>
<li>EC2<ul>
<li>server</li>
<li>web server cache</li>
</ul>
</li>
<li>DB<ul>
<li>Database</li>
<li>DB cache</li>
<li>확장 방법<ul>
<li>Master와 Slave</li>
<li>Sharding(샤딩)</li>
</ul>
</li>
</ul>
</li>
<li>S3<ul>
<li>파일을 저장하기 위한 스토리지</li>
<li>이미지와 같은 파일 저장</li>
</ul>
</li>
</ul>
</li>
<li><p>서버의 동시접속자가 늘어날 경우</p>
<ul>
<li>Upscaling<ul>
<li>서버 컴퓨터의 샤양을 높이는 것</li>
<li>서버를 사용하고 있는 입장에서는 하기 힘들다.</li>
<li>처음 서버 컴퓨터를 만들 때 사용하는 방법</li>
</ul>
</li>
<li>Outscaling<ul>
<li>서버 컴퓨터의 수를 늘리는 것</li>
<li>서버를 사용하고 있는 입장에서 사용하는 방법</li>
</ul>
</li>
</ul>
</li>
<li><p>멀티 리전</p>
<ul>
<li>물리적 거리가 존재하기 때문에 다른 나라 간에는 속도가 느리다.</li>
<li>따라서 해당 위치에 서버를 따로 구축</li>
</ul>
</li>
</ul>
<h2 id="AWS-Amazon-S3-사용하기"><a href="#AWS-Amazon-S3-사용하기" class="headerlink" title="AWS Amazon S3 사용하기"></a>AWS Amazon S3 사용하기</h2><ul>
<li><p>dstagram의 이미지 파일을 로컬이 아닌 클라우드 스토리지에 저장하기 위해 사용</p>
<ol>
<li>AWS Amazon에 가입한다.</li>
<li>AWS - IAM에서 사용자를 추가한다.<ul>
<li>‘AmazonS3FullAccess’ 권한을 추가한다.</li>
<li>Access key와 Secret key를 확인한다.<ul>
<li>해당 페이지를 끄면 다시 볼 수 없으므로 csv로 저장해둔다.</li>
</ul>
</li>
</ul>
</li>
<li>AWS- S3에서 버킷을 만든다.<ul>
<li>버킷 이름을 작성하고, 리전은 ‘아시아 태평양(서울)’을 선택한다.</li>
<li>권한 설정에서 퍼블릭 ACL 관리 체크 항목을 모두 해제한다.</li>
</ul>
</li>
<li><p>dstagra_project에서 다음 모듈을 설치한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># boto3 : Amazon S3를 사용할 수 있게 하는 모듈</span></span><br><span class="line">$ pip install boto3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 장고 프로젝트에서 특정 storage를 사용하게 하는 모듈</span></span><br><span class="line">$ pip install django-storages</span><br></pre></td></tr></table></figure>
</li>
<li><p>dstagram_project에서 settings.py를 수정한다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dstagram_project</span></span><br><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 'storages' 추가</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">    <span class="string">'accounts'</span>,</span><br><span class="line">    <span class="string">'photo'</span>,</span><br><span class="line">    <span class="string">'disqus'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sites'</span>,</span><br><span class="line">    <span class="string">'storages'</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">AWS_ACCESS_KEY_ID = <span class="string">'Amazon User Access Key ID 값'</span></span><br><span class="line">AWS_SECRET_ACCESS_KEY = <span class="string">'Amazon User Secret Key 값'</span></span><br><span class="line">AWS_REGION = <span class="string">'ap-northeast-2'</span></span><br><span class="line">AWS_STORAGE_BUCKET_NAME = <span class="string">'S3에서 만든 버킷 이름'</span></span><br><span class="line">AWS_S3_CUSTOM_DOMAIN = <span class="string">'%s.s3.%s.amazonaws.com'</span> % (AWS_STORAGE_BUCKET_NAME,AWS_REGION)</span><br><span class="line">AWS_S3_OBJECT_PARAMETERS = &#123;</span><br><span class="line">    <span class="string">'CacheControl'</span>: <span class="string">'max-age=86400'</span>,</span><br><span class="line">&#125;</span><br><span class="line">AWS_DEFAULT_ACL = <span class="string">'public-read'</span></span><br><span class="line">AWS_LOCATION = <span class="string">'static'</span></span><br><span class="line"></span><br><span class="line">STATIC_URL = <span class="string">'http://%s/%s/'</span> % (AWS_S3_CUSTOM_DOMAIN, AWS_LOCATION)</span><br><span class="line">STATICFILES_STORAGE = <span class="string">'storages.backends.s3boto3.S3Boto3Storage'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># STATIC_URL = '/static/'</span></span><br><span class="line"><span class="comment"># STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>다음 명렁어를 통해 Amazon S3에 static 관련 파일을 옮긴다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py collectstatic</span><br><span class="line"><span class="comment"># 명령어 입력 후, yes를 한번 더 입력한다.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Amazon S3의 해당 버킷에 static 파일이 옮겨졌는지 확인한다.</p>
</li>
<li>서버를 실행하고 웹페이지에 static 관련 이미지가 정상적으로 출력되는지 확인한다.</li>
</ol>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://JINUKK.github.io/2019/05/08/190508-Django-Study/" data-id="cjyco4kqx009d31wudwoe87ni" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/Sort/">Sort</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Study-Review/">Study Review</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/args/">args</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/binary-search/">binary search</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/boolean/">boolean</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bubble-sort/">bubble sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/caculator/">caculator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/call-by-object-reference/">call by object reference</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/class/">class</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/closure/">closure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/comparison/">comparison</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/comprehension/">comprehension</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/continue/">continue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/copy/">copy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csv/">csv</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decorator/">decorator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dictionary/">dictionary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dummy-double-linked-list/">dummy double linked list</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/epsilon/">epsilon</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/excel/">excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filter/">filter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/first-class-function/">first class function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/for/">for</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/function/">function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/generator/">generator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/if/">if</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/insertion-sort/">insertion sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iterator/">iterator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kwargs/">kwargs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda-function/">lambda function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linear-search/">linear search</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linked-list/">linked list</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/list/">list</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/map/">map</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/merge-sort/">merge sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/namespace/">namespace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/next/">next</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/operator/">operator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/packing/">packing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pass/">pass</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/queue/">queue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/quick-sort/">quick sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/radix/">radix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/recursive-function/">recursive function</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reduce/">reduce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selection-sort/">selection sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/set/">set</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/single-linked-list/">single linked list</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/">sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stack/">stack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stopiteration/">stopiteration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/string/">string</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/text/">text</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tower-of-hanoi/">tower of hanoi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tuple/">tuple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unpacking/">unpacking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/while/">while</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wrap/">wrap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yield/">yield</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yield-from/">yield from</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 16.67px;">algorithm</a> <a href="/tags/args/" style="font-size: 10px;">args</a> <a href="/tags/binary-search/" style="font-size: 10px;">binary search</a> <a href="/tags/boolean/" style="font-size: 10px;">boolean</a> <a href="/tags/bubble-sort/" style="font-size: 10px;">bubble sort</a> <a href="/tags/caculator/" style="font-size: 10px;">caculator</a> <a href="/tags/call-by-object-reference/" style="font-size: 10px;">call by object reference</a> <a href="/tags/class/" style="font-size: 10px;">class</a> <a href="/tags/closure/" style="font-size: 10px;">closure</a> <a href="/tags/comparison/" style="font-size: 10px;">comparison</a> <a href="/tags/comprehension/" style="font-size: 10px;">comprehension</a> <a href="/tags/continue/" style="font-size: 10px;">continue</a> <a href="/tags/copy/" style="font-size: 10px;">copy</a> <a href="/tags/csv/" style="font-size: 10px;">csv</a> <a href="/tags/decorator/" style="font-size: 10px;">decorator</a> <a href="/tags/dictionary/" style="font-size: 10px;">dictionary</a> <a href="/tags/dummy-double-linked-list/" style="font-size: 10px;">dummy double linked list</a> <a href="/tags/epsilon/" style="font-size: 10px;">epsilon</a> <a href="/tags/excel/" style="font-size: 10px;">excel</a> <a href="/tags/filter/" style="font-size: 10px;">filter</a> <a href="/tags/first-class-function/" style="font-size: 10px;">first class function</a> <a href="/tags/for/" style="font-size: 10px;">for</a> <a href="/tags/function/" style="font-size: 10px;">function</a> <a href="/tags/generator/" style="font-size: 10px;">generator</a> <a href="/tags/if/" style="font-size: 10px;">if</a> <a href="/tags/insertion-sort/" style="font-size: 10px;">insertion sort</a> <a href="/tags/iterator/" style="font-size: 10px;">iterator</a> <a href="/tags/kwargs/" style="font-size: 10px;">kwargs</a> <a href="/tags/lambda-function/" style="font-size: 10px;">lambda function</a> <a href="/tags/linear-search/" style="font-size: 10px;">linear search</a> <a href="/tags/linked-list/" style="font-size: 13.33px;">linked list</a> <a href="/tags/list/" style="font-size: 10px;">list</a> <a href="/tags/map/" style="font-size: 10px;">map</a> <a href="/tags/merge-sort/" style="font-size: 10px;">merge sort</a> <a href="/tags/namespace/" style="font-size: 10px;">namespace</a> <a href="/tags/next/" style="font-size: 10px;">next</a> <a href="/tags/operator/" style="font-size: 13.33px;">operator</a> <a href="/tags/packing/" style="font-size: 10px;">packing</a> <a href="/tags/pass/" style="font-size: 10px;">pass</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/queue/" style="font-size: 13.33px;">queue</a> <a href="/tags/quick-sort/" style="font-size: 10px;">quick sort</a> <a href="/tags/radix/" style="font-size: 10px;">radix</a> <a href="/tags/recursive-function/" style="font-size: 10px;">recursive function</a> <a href="/tags/reduce/" style="font-size: 10px;">reduce</a> <a href="/tags/selection-sort/" style="font-size: 10px;">selection sort</a> <a href="/tags/set/" style="font-size: 10px;">set</a> <a href="/tags/single-linked-list/" style="font-size: 10px;">single linked list</a> <a href="/tags/sort/" style="font-size: 10px;">sort</a> <a href="/tags/stack/" style="font-size: 10px;">stack</a> <a href="/tags/stopiteration/" style="font-size: 13.33px;">stopiteration</a> <a href="/tags/string/" style="font-size: 10px;">string</a> <a href="/tags/text/" style="font-size: 10px;">text</a> <a href="/tags/tower-of-hanoi/" style="font-size: 10px;">tower of hanoi</a> <a href="/tags/tuple/" style="font-size: 10px;">tuple</a> <a href="/tags/unpacking/" style="font-size: 10px;">unpacking</a> <a href="/tags/while/" style="font-size: 10px;">while</a> <a href="/tags/wrap/" style="font-size: 10px;">wrap</a> <a href="/tags/yield/" style="font-size: 10px;">yield</a> <a href="/tags/yield-from/" style="font-size: 10px;">yield from</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/07/18/190718-DSAA-Study/">2019.07.18 Data Structure and Algorithm Study</a>
          </li>
        
          <li>
            <a href="/2019/07/15/190715-DSAA-Study/">2019.07.15 Data Structure and Algorithm Study</a>
          </li>
        
          <li>
            <a href="/2019/07/11/190711-DSAA-Study/">2019.07.11 Data Structure and Algorithm Study</a>
          </li>
        
          <li>
            <a href="/2019/07/08/190708-DSAA-Study/">2019.07.08 Data Structure and Algorithm Study</a>
          </li>
        
          <li>
            <a href="/2019/07/04/190704-DSAA-Study/">2019.07.04 Data Structure and Algorithm Study</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 JINWOOK KOO<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>